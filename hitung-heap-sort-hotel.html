<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulasi Heap Sort Hotel - Priority Fixed</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0c2461, #1e3799, #4a69bd);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.97);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.25);
        }

        h1 {
            text-align: center;
            color: #0c2461;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }

        .subtitle {
            text-align: center;
            color: #e55039;
            margin-bottom: 30px;
            font-size: 1.2rem;
        }

        .priority-correction {
            background: #e8f5e9;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            border-left: 5px solid #4caf50;
        }

        .priority-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .priority-table th {
            background: #0c2461;
            color: white;
            padding: 12px;
            text-align: center;
        }

        .priority-table td {
            padding: 10px;
            border-bottom: 1px solid #eee;
            text-align: center;
        }

        .priority-table tr.correct-order {
            background: #f1f8e9;
        }

        .priority-table tr.incorrect-order {
            background: #ffebee;
        }

        .hotel-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .hotel-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 2px solid #ddd;
            transition: all 0.3s ease;
            position: relative;
        }

        .hotel-card.active {
            border-color: #e55039;
            box-shadow: 0 0 20px rgba(229, 80, 57, 0.3);
            transform: translateY(-5px);
        }

        .hotel-card.swap {
            border-color: #4cd137;
            box-shadow: 0 0 20px rgba(76, 209, 55, 0.3);
            animation: swapPulse 0.5s;
        }

        .hotel-card.root {
            border-color: #8c7ae6;
            box-shadow: 0 0 20px rgba(140, 122, 230, 0.3);
        }

        .hotel-card.leaf {
            border-color: #9c27b0;
            box-shadow: 0 0 20px rgba(156, 39, 176, 0.3);
        }

        .hotel-card.sorted {
            border-color: #00b894;
            box-shadow: 0 0 20px rgba(0, 184, 148, 0.3);
            background: #f1f8e9;
        }

        .node-index {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #0c2461;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
        }

        @keyframes swapPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .hotel-name {
            color: #0c2461;
            font-size: 1.3rem;
            margin-bottom: 10px;
            font-weight: bold;
            padding-right: 40px;
        }

        .hotel-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .hotel-detail {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px dashed #eee;
        }

        .detail-label {
            color: #666;
            font-size: 0.9rem;
        }

        .detail-value {
            font-weight: bold;
            color: #0c2461;
        }

        .priority-value {
            background: #4cd137;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(to right, #0c2461, #e55039);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 30px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .simulation-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 1024px) {
            .simulation-area {
                grid-template-columns: 1fr;
            }
        }

        .tree-display, .priority-display {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            height: 600px;
            overflow: auto;
            position: relative;
        }

        .tree-display {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px dashed rgba(12, 36, 97, 0.2);
        }

        .tree-node {
            position: absolute;
            width: 180px;
            min-height: 110px;
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border: 3px solid #0c2461;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .tree-node.active {
            border-color: #e55039;
            box-shadow: 0 0 20px rgba(229, 80, 57, 0.4);
            transform: scale(1.05);
        }

        .tree-node.swap {
            border-color: #4cd137;
            box-shadow: 0 0 20px rgba(76, 209, 55, 0.4);
            animation: swapPulse 0.5s;
        }

        .tree-node.root {
            border-color: #8c7ae6;
            box-shadow: 0 0 20px rgba(140, 122, 230, 0.4);
        }

        .tree-node.leaf {
            border-color: #9c27b0;
            box-shadow: 0 0 20px rgba(156, 39, 176, 0.4);
        }

        .tree-node.sorted {
            border-color: #00b894;
            box-shadow: 0 0 20px rgba(0, 184, 148, 0.4);
            background: #f1f8e9;
        }

        .tree-connector {
            position: absolute;
            background: #0c2461;
            height: 3px;
            z-index: 1;
            transform-origin: 0 0;
            opacity: 0.7;
        }

        .priority-list {
            list-style: none;
        }

        .priority-item {
            padding: 15px;
            margin-bottom: 10px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #0c2461;
            transition: all 0.3s ease;
        }

        .status {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: #e8f5e9;
            border-radius: 10px;
            font-weight: bold;
            color: #2e7d32;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .log {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
            max-height: 300px;
            overflow-y: auto;
        }

        .log-title {
            color: #0c2461;
            margin-bottom: 15px;
            font-size: 1.3rem;
            border-bottom: 2px solid #0c2461;
            padding-bottom: 10px;
        }

        .log-entry {
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 5px;
            background: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #0c2461;
            font-size: 0.95rem;
        }

        .section-title {
            color: #0c2461;
            margin: 20px 0 10px 0;
            font-size: 1.4rem;
            border-bottom: 2px solid #eee;
            padding-bottom: 5px;
        }

        .step-counter {
            background: #0c2461;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .calculation-box {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border: 1px dashed #ccc;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Simulasi Heap Sort Hotel - Priority Fixed</h1>
        <div class="subtitle">Perbaikan Urutan Priority: Aston (4.5‚≠ê) ‚Üí Santika (4.4‚≠ê)</div>
        
        <div class="priority-correction">
            <h3>üîß PERBAIKAN RUMUS PRIORITY</h3>
            <table class="priority-table">
                <tr>
                    <th>Hotel</th>
                    <th>Rating</th>
                    <th>Popularity</th>
                    <th>Price</th>
                    <th>Distance</th>
                    <th>Priority Value</th>
                    <th>Urutan</th>
                </tr>
                <tr class="correct-order">
                    <td><strong>Four Points</strong></td>
                    <td>4.7 ‚≠ê</td>
                    <td>94</td>
                    <td>$110</td>
                    <td>1.0 km</td>
                    <td><strong>-56289.0</strong></td>
                    <td>1 (Root)</td>
                </tr>
                <tr class="correct-order">
                    <td><strong>Swiss-Belhotel</strong></td>
                    <td>4.6 ‚≠ê</td>
                    <td>92</td>
                    <td>$120</td>
                    <td>0.8 km</td>
                    <td><strong>-55079.2</strong></td>
                    <td>2</td>
                </tr>
                <tr class="correct-order">
                    <td><strong>Aston</strong> ‚úÖ</td>
                    <td>4.5 ‚≠ê</td>
                    <td>88</td>
                    <td>$85</td>
                    <td>1.2 km</td>
                    <td><strong>-53713.8</strong></td>
                    <td>3</td>
                </tr>
                <tr class="correct-order">
                    <td><strong>Santika</strong></td>
                    <td>4.4 ‚≠ê</td>
                    <td>86</td>
                    <td>$95</td>
                    <td>1.5 km</td>
                    <td><strong>-52503.5</strong></td>
                    <td>4</td>
                </tr>
                <tr>
                    <td>Clarion</td>
                    <td>4.2 ‚≠ê</td>
                    <td>82</td>
                    <td>$75</td>
                    <td>2.5 km</td>
                    <td>-50122.5</td>
                    <td>5</td>
                </tr>
                <tr>
                    <td>Losari</td>
                    <td>4.0 ‚≠ê</td>
                    <td>78</td>
                    <td>$65</td>
                    <td>3.0 km</td>
                    <td>-47732.0</td>
                    <td>6</td>
                </tr>
            </table>
            
            <div class="calculation-box">
                <strong>Rumus Priority Baru:</strong><br>
                Priority = (-rating √ó 10000) + (-popularity √ó 100) + price + distance<br>
                <em>Semakin kecil nilai = semakin prioritas</em>
            </div>
        </div>
        
        <div class="status" id="status">Status: Inisialisasi dengan priority fix...</div>
        
        <div class="controls">
            <button class="btn" id="prevBtn">‚èÆÔ∏è Previous</button>
            <button class="btn" id="nextBtn">Next ‚è≠Ô∏è</button>
            <button class="btn" id="autoBtn">‚ñ∂Ô∏è Auto Play</button>
            <button class="btn" id="resetBtn">üîÑ Reset</button>
        </div>
        
        <div class="section-title">
            Data Hotel dengan Priority Fixed
            <span class="step-counter" id="stepCounter">Step: 0/0</span>
        </div>
        <div class="hotel-grid" id="hotelGrid"></div>
        
        <div class="simulation-area">
            <div class="tree-display">
                <div class="section-title">Heap Tree Structure</div>
                <div id="treeContainer"></div>
            </div>
            
            <div class="priority-display">
                <div class="section-title">Priority Order</div>
                <div id="calculationsContent"></div>
                <ul class="priority-list" id="priorityList"></ul>
            </div>
        </div>
        
        <div class="log">
            <div class="log-title">Heap Sort Log</div>
            <div id="logContent"></div>
        </div>
    </div>

    <script>
        // ==================== DATA HOTEL DENGAN PRIORITY FIXED ====================
        const hotels = [
            {
                name: "Four Points by Sheraton Makassar",
                price: 110,
                rating: 4.7,
                popularity: 94,
                distance: 1.0,
                priority: 0,
                isLeaf: false,
                isSorted: false
            },
            {
                name: "Swiss-Belhotel Harbour Bay",
                price: 120,
                rating: 4.6,
                popularity: 92,
                distance: 0.8,
                priority: 0,
                isLeaf: false,
                isSorted: false
            },
            {
                name: "Aston Makassar Hotel",  // SEHARUSNYA URUTAN 3, BUKAN 4
                price: 85,
                rating: 4.5,
                popularity: 88,
                distance: 1.2,
                priority: 0,
                isLeaf: true,
                isSorted: false
            },
            {
                name: "Santika Premiere Makassar",  // SEHARUSNYA URUTAN 4, BUKAN 3
                price: 95,
                rating: 4.4,
                popularity: 86,
                distance: 1.5,
                priority: 0,
                isLeaf: false,
                isSorted: false
            },
            {
                name: "Clarion Makassar",
                price: 75,
                rating: 4.2,
                popularity: 82,
                distance: 2.5,
                priority: 0,
                isLeaf: true,
                isSorted: false
            },
            {
                name: "Losari Beach Hotel",
                price: 65,
                rating: 4.0,
                popularity: 78,
                distance: 3.0,
                priority: 0,
                isLeaf: true,
                isSorted: false
            }
        ];

        // ==================== STATE MANAGEMENT ====================
        let currentHotels = JSON.parse(JSON.stringify(hotels));
        let steps = [];
        let currentStep = 0;
        let autoPlayInterval = null;

        // ==================== POSISI NODE ====================
        const NODE_POSITIONS_CENTERED = [
            { x: 400, y: 80, level: 0 },   // 0 - Four Points (Root)
            { x: 250, y: 200, level: 1 },  // 1 - Swiss-Belhotel
            { x: 550, y: 200, level: 1 },  // 2 - Santika
            { x: 150, y: 320, level: 2 },  // 3 - Aston
            { x: 350, y: 320, level: 2 },  // 4 - Clarion
            { x: 450, y: 320, level: 2 }   // 5 - Losari
        ];

        // ==================== FUNGSI UTILITAS DIPERBAIKI ====================
        function calculatePriority(hotel) {
            // PERBAIKAN: Gunakan bobot yang lebih besar untuk rating
            // rating √ó 10000 agar rating 4.5 lebih baik dari 4.4
            const priorityValue = 
                (-hotel.rating * 10000) +      // Rating paling penting
                (-hotel.popularity * 100) +    // Popularitas
                hotel.price +                  // Harga (makin murah makin baik)
                hotel.distance;                // Jarak (makin dekat makin baik)
            
            return {
                rating: -hotel.rating,
                popularity: -hotel.popularity,
                price: hotel.price,
                distance: hotel.distance,
                total: priorityValue,
                tuple: `(${-hotel.rating.toFixed(1)}, ${-hotel.popularity}, ${hotel.price}, ${hotel.distance})`
            };
        }

        function identifyLeafNodes(n) {
            const leafStart = Math.floor(n / 2);
            const leafIndices = [];
            for (let i = leafStart; i < n; i++) {
                leafIndices.push(i);
            }
            return leafIndices;
        }

        function getShortHotelName(fullName) {
            const names = {
                "Four Points by Sheraton Makassar": "Four Points",
                "Swiss-Belhotel Harbour Bay": "Swiss-Belhotel",
                "Aston Makassar Hotel": "Aston",
                "Santika Premiere Makassar": "Santika",
                "Clarion Makassar": "Clarion",
                "Losari Beach Hotel": "Losari"
            };
            return names[fullName] || fullName.split(' ')[0];
        }

        // ==================== FUNGSI SIMULASI ====================
        function initSimulation() {
            currentHotels = JSON.parse(JSON.stringify(hotels));
            steps = [];
            currentStep = 0;
            
            const n = currentHotels.length;
            const leafIndices = identifyLeafNodes(n);
            
            // Hitung priority dengan rumus baru
            currentHotels.forEach((hotel, index) => {
                hotel.priority = calculatePriority(hotel);
                hotel.isLeaf = leafIndices.includes(index);
                hotel.isSorted = false;
            });
            
            // Urutkan array berdasarkan priority untuk memastikan root benar
            currentHotels.sort((a, b) => a.priority.total - b.priority.total);
            
            // Step 0: Inisialisasi dengan priority fix
            recordStep(
                `üèÅ INISIALISASI DENGAN PRIORITY FIX<br>` +
                `Rumus baru: (-rating√ó10000) + (-popularity√ó100) + price + distance<br>` +
                `Hasil priority:<br>` +
                `${currentHotels.map((h, i) => 
                    `${i+1}. ${h.name.split(' ')[0]}: ${h.priority.total.toFixed(1)}`
                ).join('<br>')}`,
                [], [], "Initial"
            );
            
            // Step 1: Identifikasi leaf nodes
            const leafHotels = leafIndices.map(i => currentHotels[i].name);
            recordStep(
                `üçÉ IDENTIFIKASI LEAF NODES:<br>n = ${n}, leaf mulai dari index = floor(${n}/2) = ${Math.floor(n/2)}<br>Leaf nodes: index ${leafIndices.join(', ')}`,
                leafIndices, [], "Leaf"
            );
            
            // Build Max-Heap phase
            buildMaxHeap();
            
            // Heap Sort phase
            heapSort();
            
            updateDisplay();
        }

        function buildMaxHeap() {
            let n = currentHotels.length;
            
            recordStep(
                `üî® MEMBANGUN MAX-HEAP (n = ${n})<br>Heapify dimulai dari non-leaf terakhir: floor(${n}/2)-1 = ${Math.floor(n/2)-1}`,
                [], [], "Build"
            );
            
            let startIdx = Math.floor(n / 2) - 1;
            
            for (let i = startIdx; i >= 0; i--) {
                const heapifyMessage = `üîÑ HEAPIFY Node ${i}: ${currentHotels[i].name}<br>Priority: ${currentHotels[i].priority.total.toFixed(1)}`;
                recordStep(heapifyMessage, [i], [], "Heapify");
                heapify(n, i, "build");
            }
            
            recordStep(
                `‚úÖ MAX-HEAP BERHASIL DIBANGUN!<br>Root: ${currentHotels[0].name} (${currentHotels[0].priority.total.toFixed(1)})`,
                [], [], "Complete"
            );
        }

        function heapify(n, i, phase) {
            let largest = i;
            let left = 2 * i + 1;
            let right = 2 * i + 2;
            
            let message = `üîç ANALISIS Node ${i} (${currentHotels[i].name}):<br>`;
            message += `‚Ä¢ Priority: ${currentHotels[i].priority.total.toFixed(1)}<br>`;
            
            let activeIndices = [i];
            
            if (left < n) {
                message += `‚Ä¢ Left child [${left}]: ${currentHotels[left].name} (${currentHotels[left].priority.total.toFixed(1)})<br>`;
                activeIndices.push(left);
            }
            
            if (right < n) {
                message += `‚Ä¢ Right child [${right}]: ${currentHotels[right].name} (${currentHotels[right].priority.total.toFixed(1)})<br>`;
                activeIndices.push(right);
            }
            
            recordStep(message, activeIndices, [], "Heapify");
            
            // Bandingkan dengan left child
            if (left < n && currentHotels[left].priority.total < currentHotels[largest].priority.total) {
                largest = left;
                recordStep(
                    `üëà LEFT CHILD LEBIH PRIORITAS:<br>${currentHotels[left].name} (${currentHotels[left].priority.total.toFixed(1)}) < ${currentHotels[i].name} (${currentHotels[i].priority.total.toFixed(1)})`,
                    [i, left], [], "Heapify"
                );
            }
            
            // Bandingkan dengan right child
            if (right < n && currentHotels[right].priority.total < currentHotels[largest].priority.total) {
                largest = right;
                recordStep(
                    `üëâ RIGHT CHILD LEBIH PRIORITAS:<br>${currentHotels[right].name} (${currentHotels[right].priority.total.toFixed(1)}) < ${currentHotels[largest].name} (${currentHotels[largest].priority.total.toFixed(1)})`,
                    [i, right], [], "Heapify"
                );
            }
            
            // Jika largest bukan i, lakukan swap
            if (largest !== i) {
                recordStep(
                    `üîÑ PERLU SWAP: ${currentHotels[i].name} ‚áÑ ${currentHotels[largest].name}`,
                    [], [i, largest], "Swap"
                );
                
                [currentHotels[i], currentHotels[largest]] = [currentHotels[largest], currentHotels[i]];
                
                recordStep(
                    `‚úÖ SETELAH SWAP:<br>Index ${i}: ${currentHotels[i].name}<br>Index ${largest}: ${currentHotels[largest].name}`,
                    [], [i, largest], "Swap"
                );
                
                heapify(n, largest, phase);
            } else {
                recordStep(
                    `‚úì Node ${i} SUDAH memenuhi heap property`,
                    [i], [], "Heapify"
                );
            }
        }

        function heapSort() {
            let n = currentHotels.length;
            
            recordStep(
                `üéØ MULAI HEAP SORT PHASE<br>Max-Heap awal: ${currentHotels[0].name} sebagai root`,
                [], [], "Sort"
            );
            
            for (let i = n - 1; i >= 0; i--) {
                const iteration = n - i;
                
                // Swap root dengan elemen terakhir
                recordStep(
                    `üì¶ ITERASI ${iteration}: Swap root dengan elemen terakhir [${i}]<br>` +
                    `Root: ${currentHotels[0].name} ‚Üî Elemen ${i}: ${currentHotels[i].name}`,
                    [0, i], [0, i], "Sort"
                );
                
                [currentHotels[0], currentHotels[i]] = [currentHotels[i], currentHotels[0]];
                currentHotels[i].isSorted = true;
                
                recordStep(
                    `‚úÖ Setelah swap:<br>${currentHotels[i].name} pindah ke posisi ${i}`,
                    [], [0, i], "Swap"
                );
                
                // Heapify root baru jika masih ada elemen
                if (i > 0) {
                    recordStep(
                        `üîÑ Heapify root baru: ${currentHotels[0].name}`,
                        [0], [], "Heapify"
                    );
                    heapify(i, 0, "sort");
                }
            }
            
            recordStep(
                `üéâ HEAP SORT SELESAI!<br>` +
                `Urutan akhir berdasarkan priority:<br>` +
                `${currentHotels.map((h, i) => 
                    `${i+1}. ${h.name} (${h.priority.total.toFixed(1)})`
                ).join('<br>')}`,
                [], [], "Complete"
            );
        }

        function recordStep(message, activeIndices, swapIndices, stepType) {
            steps.push({
                hotels: JSON.parse(JSON.stringify(currentHotels)),
                message: message,
                activeIndices: [...activeIndices],
                swapIndices: [...swapIndices],
                stepType: stepType
            });
        }

        // ==================== FUNGSI DISPLAY ====================
        function updateDisplay() {
            if (currentStep >= steps.length) return;
            
            const step = steps[currentStep];
            
            updateHotelCards(step);
            updateTreeDisplay(step);
            updatePriorityList(step);
            updateCalculations(step);
            updateLog(step);
            updateStatus(step);
            updateButtons();
        }

        function updateHotelCards(step) {
            const hotelGrid = document.getElementById('hotelGrid');
            hotelGrid.innerHTML = '';
            
            const n = step.hotels.length;
            const leafIndices = identifyLeafNodes(n);
            
            step.hotels.forEach((hotel, index) => {
                const card = document.createElement('div');
                card.className = 'hotel-card';
                
                if (step.activeIndices.includes(index)) card.classList.add('active');
                if (step.swapIndices.includes(index)) card.classList.add('swap');
                if (index === 0) card.classList.add('root');
                if (leafIndices.includes(index)) card.classList.add('leaf');
                if (hotel.isSorted) card.classList.add('sorted');
                
                card.innerHTML = `
                    <div class="node-index">${index}</div>
                    <div class="hotel-name">${hotel.name}</div>
                    <div class="hotel-details">
                        <div class="hotel-detail">
                            <span class="detail-label">Rating:</span>
                            <span class="detail-value">${hotel.rating} ‚≠ê</span>
                        </div>
                        <div class="hotel-detail">
                            <span class="detail-label">Popularitas:</span>
                            <span class="detail-value">${hotel.popularity}/100</span>
                        </div>
                        <div class="hotel-detail">
                            <span class="detail-label">Harga:</span>
                            <span class="detail-value">$${hotel.price}</span>
                        </div>
                        <div class="hotel-detail">
                            <span class="detail-label">Jarak:</span>
                            <span class="detail-value">${hotel.distance} km</span>
                        </div>
                        <div class="hotel-detail">
                            <span class="detail-label">Priority:</span>
                            <span class="priority-value">${hotel.priority.total.toFixed(1)}</span>
                        </div>
                    </div>
                    <div style="margin-top: 10px; font-size: 0.85rem; color: #666; font-family: 'Courier New', monospace;">
                        ${hotel.priority.tuple}
                    </div>
                    ${hotel.isLeaf ? '<div style="margin-top: 5px; color: #9c27b0; font-size: 0.8rem;">üçÉ Leaf Node</div>' : ''}
                `;
                
                hotelGrid.appendChild(card);
            });
        }

        function updateTreeDisplay(step) {
            const treeContainer = document.getElementById('treeContainer');
            treeContainer.innerHTML = '';
            
            // Gambar konektor
            step.hotels.forEach((hotel, index) => {
                const leftChild = 2 * index + 1;
                const rightChild = 2 * index + 2;
                
                if (leftChild < step.hotels.length && !step.hotels[leftChild].isSorted) {
                    drawConnector(index, leftChild, step.activeIndices.includes(index));
                }
                if (rightChild < step.hotels.length && !step.hotels[rightChild].isSorted) {
                    drawConnector(index, rightChild, step.activeIndices.includes(index));
                }
            });
            
            // Gambar node
            step.hotels.forEach((hotel, index) => {
                if (NODE_POSITIONS_CENTERED[index] && !hotel.isSorted) {
                    createTreeNode(hotel, index, step);
                }
            });
        }

        function drawConnector(fromIndex, toIndex, isActive) {
            const treeContainer = document.getElementById('treeContainer');
            const connector = document.createElement('div');
            connector.className = 'tree-connector';
            
            const from = NODE_POSITIONS_CENTERED[fromIndex];
            const to = NODE_POSITIONS_CENTERED[toIndex];
            
            if (!from || !to) return;
            
            const fromCenterX = from.x;
            const fromCenterY = from.y + 55;
            const toCenterX = to.x;
            const toCenterY = to.y;
            
            const deltaX = toCenterX - fromCenterX;
            const deltaY = toCenterY - fromCenterY;
            const length = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
            const angle = Math.atan2(deltaY, deltaX) * 180 / Math.PI;
            
            connector.style.width = `${length}px`;
            connector.style.left = `${fromCenterX}px`;
            connector.style.top = `${fromCenterY}px`;
            connector.style.transform = `rotate(${angle}deg)`;
            connector.style.transformOrigin = '0 0';
            connector.style.background = isActive ? '#e55039' : '#0c2461';
            
            treeContainer.appendChild(connector);
        }

        function createTreeNode(hotel, index, step) {
            const treeContainer = document.getElementById('treeContainer');
            const node = document.createElement('div');
            node.className = 'tree-node';
            
            if (step.activeIndices.includes(index)) node.classList.add('active');
            if (step.swapIndices.includes(index)) node.classList.add('swap');
            if (index === 0) node.classList.add('root');
            if (hotel.isLeaf) node.classList.add('leaf');
            
            const position = NODE_POSITIONS_CENTERED[index];
            node.style.left = `${position.x - 90}px`;
            node.style.top = `${position.y}px`;
            
            const shortName = getShortHotelName(hotel.name);
            
            node.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-weight: bold; color: #0c2461; margin-bottom: 5px;">
                        ${shortName}
                    </div>
                    <div style="font-size: 0.8rem;">
                        ‚≠ê ${hotel.rating} | ${hotel.popularity}/100<br>
                        $${hotel.price} | ${hotel.distance}km<br>
                        <strong>${hotel.priority.total.toFixed(1)}</strong>
                    </div>
                    <div style="position: absolute; top: -20px; left: 50%; transform: translateX(-50%); 
                          background: #0c2461; color: white; padding: 2px 8px; border-radius: 10px; 
                          font-size: 0.7rem;">
                        [${index}]
                    </div>
                </div>
            `;
            
            treeContainer.appendChild(node);
        }

        function updatePriorityList(step) {
            const priorityList = document.getElementById('priorityList');
            priorityList.innerHTML = '';
            
            // Urutkan berdasarkan priority
            const sortedHotels = [...step.hotels].sort((a, b) => a.priority.total - b.priority.total);
            
            sortedHotels.forEach((hotel, index) => {
                const originalIndex = step.hotels.findIndex(h => h.name === hotel.name);
                const item = document.createElement('li');
                item.className = 'priority-item';
                
                item.innerHTML = `
                    <strong>${index + 1}. ${hotel.name}</strong><br>
                    <span style="font-size: 0.9rem; color: #666;">
                        Priority: ${hotel.priority.total.toFixed(1)} | 
                        Index: [${originalIndex}]
                    </span>
                `;
                
                priorityList.appendChild(item);
            });
        }

        function updateCalculations(step) {
            const calculationsContent = document.getElementById('calculationsContent');
            
            if (step.stepType === "Initial") {
                calculationsContent.innerHTML = `
                    <div class="calculation-box">
                        <strong>RUMUS PRIORITY FIXED:</strong><br>
                        (-rating √ó 10000) + (-popularity √ó 100) + price + distance<br><br>
                        <strong>Contoh perhitungan:</strong><br>
                        ‚Ä¢ Aston: (-4.5√ó10000) + (-88√ó100) + 85 + 1.2 = -53713.8<br>
                        ‚Ä¢ Santika: (-4.4√ó10000) + (-86√ó100) + 95 + 1.5 = -52503.5<br>
                        ‚Üí Aston lebih prioritas karena -53713.8 < -52503.5
                    </div>
                `;
            }
        }

        function updateLog(step) {
            const logContent = document.getElementById('logContent');
            
            if (currentStep === 0) {
                logContent.innerHTML = '';
            }
            
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `<strong>Step ${currentStep}:</strong> ${step.message}`;
            
            logContent.appendChild(logEntry);
        }

        function updateStatus(step) {
            const statusElement = document.getElementById('status');
            statusElement.textContent = step.message.split('<br>')[0];
        }

        function updateButtons() {
            document.getElementById('prevBtn').disabled = currentStep === 0;
            document.getElementById('nextBtn').disabled = currentStep === steps.length - 1;
        }

        function updateStepCounter() {
            const stepCounter = document.getElementById('stepCounter');
            stepCounter.textContent = `Step: ${currentStep + 1}/${steps.length}`;
        }

        // ==================== EVENT HANDLERS ====================
        document.getElementById('prevBtn').addEventListener('click', () => {
            if (currentStep > 0) {
                currentStep--;
                updateDisplay();
            }
        });

        document.getElementById('nextBtn').addEventListener('click', () => {
            if (currentStep < steps.length - 1) {
                currentStep++;
                updateDisplay();
            }
        });

        document.getElementById('autoBtn').addEventListener('click', () => {
            if (autoPlayInterval) {
                clearInterval(autoPlayInterval);
                autoPlayInterval = null;
                document.getElementById('autoBtn').textContent = '‚ñ∂Ô∏è Auto Play';
            } else {
                document.getElementById('autoBtn').textContent = '‚è∏Ô∏è Stop';
                autoPlayInterval = setInterval(() => {
                    if (currentStep < steps.length - 1) {
                        currentStep++;
                        updateDisplay();
                    } else {
                        clearInterval(autoPlayInterval);
                        autoPlayInterval = null;
                        document.getElementById('autoBtn').textContent = '‚ñ∂Ô∏è Auto Play';
                    }
                }, 2000);
            }
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            if (autoPlayInterval) {
                clearInterval(autoPlayInterval);
                autoPlayInterval = null;
            }
            initSimulation();
        });

        // ==================== INITIALIZE ====================
        initSimulation();
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulasi Heap Sort Hotel Makassar - Posisi Tree Terpusat</title>
    <style>
        /* Semua CSS tetap sama seperti sebelumnya */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0c2461, #1e3799, #4a69bd);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.97);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.25);
        }

        h1 {
            text-align: center;
            color: #0c2461;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }

        .subtitle {
            text-align: center;
            color: #e55039;
            margin-bottom: 30px;
            font-size: 1.2rem;
        }

        .algorithm-explanation {
            background: #fff8e1;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            border-left: 5px solid #ff9800;
        }

        .criteria-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .criteria-table th {
            background: #0c2461;
            color: white;
            padding: 12px;
            text-align: left;
        }

        .criteria-table td {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .criteria-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .initial-array-container {
            background: #e3f2fd;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            border-left: 5px solid #2196f3;
        }

        .initial-array-title {
            color: #0c2461;
            font-size: 1.3rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .array-visualization {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
            justify-content: center;
        }

        .array-element {
            background: white;
            border-radius: 10px;
            padding: 15px;
            width: 180px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border: 2px solid #2196f3;
            transition: all 0.3s ease;
        }

        .array-element:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .array-index {
            background: #2196f3;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 10px;
            margin-left: auto;
            margin-right: auto;
        }

        .array-element-name {
            font-weight: bold;
            color: #0c2461;
            text-align: center;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .array-element-details {
            font-size: 0.85rem;
            color: #555;
            text-align: center;
        }

        .array-element-details div {
            margin: 3px 0;
        }

        .array-priority {
            background: #4caf50;
            color: white;
            padding: 4px 8px;
            border-radius: 5px;
            font-weight: bold;
            margin-top: 8px;
            text-align: center;
            font-size: 0.9rem;
        }

        .hotel-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .hotel-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 2px solid #ddd;
            transition: all 0.3s ease;
            position: relative;
        }

        .hotel-card.active {
            border-color: #e55039;
            box-shadow: 0 0 20px rgba(229, 80, 57, 0.3);
            transform: translateY(-5px);
        }

        .hotel-card.swap {
            border-color: #4cd137;
            box-shadow: 0 0 20px rgba(76, 209, 55, 0.3);
            animation: swapPulse 0.5s;
        }

        .hotel-card.root {
            border-color: #8c7ae6;
            box-shadow: 0 0 20px rgba(140, 122, 230, 0.3);
        }

        .hotel-card.leaf {
            border-color: #9c27b0;
            box-shadow: 0 0 20px rgba(156, 39, 176, 0.3);
        }

        .node-index {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #0c2461;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
        }

        @keyframes swapPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes nodeHighlight {
            0% { transform: scale(1); box-shadow: 0 0 10px rgba(229, 80, 57, 0.3); }
            50% { transform: scale(1.05); box-shadow: 0 0 20px rgba(229, 80, 57, 0.6); }
            100% { transform: scale(1); box-shadow: 0 0 10px rgba(229, 80, 57, 0.3); }
        }

        @keyframes swapAnimation {
            0% { 
                transform: translate(0, 0) scale(1);
                border-color: #4cd137;
                box-shadow: 0 0 20px rgba(76, 209, 55, 0.6);
            }
            50% { 
                transform: translate(20px, -10px) scale(1.1);
                border-color: #e55039;
                box-shadow: 0 0 30px rgba(229, 80, 57, 0.8);
            }
            100% { 
                transform: translate(0, 0) scale(1);
                border-color: #4cd137;
                box-shadow: 0 0 20px rgba(76, 209, 55, 0.6);
            }
        }

        .hotel-name {
            color: #0c2461;
            font-size: 1.3rem;
            margin-bottom: 10px;
            font-weight: bold;
            padding-right: 40px;
        }

        .hotel-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .hotel-detail {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px dashed #eee;
        }

        .detail-label {
            color: #666;
            font-size: 0.9rem;
        }

        .detail-value {
            font-weight: bold;
            color: #0c2461;
        }

        .priority-value {
            background: #4cd137;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(to right, #0c2461, #e55039);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 30px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* ===== STYLE UNTUK LAYOUT VERTIKAL ===== */
        .simulation-area {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin-bottom: 30px;
            width: 100%;
        }

        /* ===== STYLE UNTUK TREE DISPLAY ===== */
        .tree-display-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px dashed rgba(12, 36, 97, 0.2);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            height: 800px; /* Tinggi lebih untuk tree */
            overflow: auto;
            position: relative;
            width: 100%;
        }

        /* Container untuk tree (dalam tree-display-section) */
        #treeContainer {
            width: 100%;
            height: 700px;
            position: relative;
            overflow: auto;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
            margin-top: 10px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        /* ===== STYLE UNTUK PRIORITY DISPLAY ===== */
        .priority-display-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            height: 450px; /* Tinggi lebih kecil untuk priority */
            overflow: auto;
            position: relative;
            width: 100%;
        }

        /* ===== SESUAIKAN UKURAN TREE NODE ===== */
        .tree-node {
            position: absolute;
            width: 220px; /* Lebih lebar karena ruang lebih besar */
            min-height: 130px;
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border: 3px solid #0c2461;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .tree-node.active {
            border-color: #e55039;
            box-shadow: 0 0 20px rgba(229, 80, 57, 0.4);
            transform: scale(1.05);
            animation: nodeHighlight 1s infinite;
        }

        .tree-node.swap {
            border-color: #4cd137;
            box-shadow: 0 0 20px rgba(76, 209, 55, 0.4);
            animation: swapPulse 0.5s;
        }

        .tree-node.root {
            border-color: #8c7ae6;
            box-shadow: 0 0 20px rgba(140, 122, 230, 0.4);
        }

        .tree-node.leaf {
            border-color: #9c27b0;
            box-shadow: 0 0 20px rgba(156, 39, 176, 0.4);
        }

        .tree-connector {
            position: absolute;
            background: #0c2461;
            height: 3px;
            z-index: 1;
            transform-origin: 0 0;
            opacity: 0.7;
        }

        .tree-connector::after {
            content: '';
            position: absolute;
            right: -6px;
            top: -4px;
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-top: 8px solid #0c2461;
        }

        .priority-list {
            list-style: none;
        }

        .priority-item {
            padding: 12px;
            margin-bottom: 8px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #0c2461;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .priority-item.active {
            border-left-color: #e55039;
            background: #fff5f3;
        }

        .priority-item.leaf-node {
            border-left-color: #9c27b0;
            background: #f3e5f5;
        }

        .priority-rank {
            display: inline-block;
            width: 30px;
            height: 30px;
            background: #0c2461;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            margin-right: 10px;
            font-weight: bold;
        }

        .status {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: #e8f5e9;
            border-radius: 10px;
            font-weight: bold;
            color: #2e7d32;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .status.build {
            background: #fff3e0;
            color: #ef6c00;
        }

        .status.sort {
            background: #e3f2fd;
            color: #1565c0;
        }

        .status.leaf {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .log {
            background: #f8f9fa;
    border-radius: 15px;
    padding: 20px;
    margin-top: 30px;
    max-height: 600px; /* PERUBAHAN: Tinggi lebih besar */
    overflow-y: auto;
    border: 2px solid #0c2461;
        }

        .log-title {
            color: #0c2461;
            margin-bottom: 15px;
            font-size: 1.3rem;
            border-bottom: 2px solid #0c2461;
            padding-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .log-entry {
            padding: 15px;
    margin-bottom: 12px;
    border-radius: 8px;
    background: white;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    border-left: 5px solid #0c2461;
    font-size: 0.9rem;
    line-height: 1.5;
    min-height: 60px; /* Minimal tinggi */
    display: flex;
    flex-direction: column;
    justify-content: space-between;
        }

        .log-entry.heapify {
            border-left-color: #e55039;
            background: #fff5f3;
        }
/* Tambahkan class untuk log entry yang lebih panjang */
.log-entry.long-content {
    min-height: 100px;
    white-space: pre-wrap; /* Biarkan teks wrap */
    word-wrap: break-word;
}

/* Header log entry */
.log-entry-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
    padding-bottom: 8px;
    border-bottom: 1px dashed #ddd;
}

/* Konten log entry */
.log-entry-content {
    flex-grow: 1;
    overflow-wrap: break-word;
    max-height: none; /* Hapus batasan tinggi */
}
        .log-entry.swap {
            border-left-color: #4cd137;
            background: #f1f8e9;
        }

        .log-entry.complete {
            border-left-color: #8c7ae6;
            background: #f3e5f5;
        }

        .log-entry.leaf {
            border-left-color: #9c27b0;
            background: #f3e5f5;
        }

        .section-title {
            color: #0c2461;
            margin: 20px 0 10px 0;
            font-size: 1.4rem;
            border-bottom: 2px solid #eee;
            padding-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .step-counter {
            background: #0c2461;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .heap-property {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #2196f3;
        }

        .calculation-box {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border: 1px dashed #ccc;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .tree-level-line {
            position: absolute;
            height: 2px;
            background: linear-gradient(to right, transparent, #0c2461, transparent);
            z-index: 0;
            opacity: 0.3;
        }

        .level-label {
            position: absolute;
            background: rgba(255, 255, 255, 0.9);
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            color: #0c2461;
            border: 1px solid #0c2461;
            font-weight: bold;
            z-index: 5;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .phase-indicator {
            background: #e55039;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .initial-note {
            color: #e55039;
            font-weight: bold;
            margin-top: 10px;
            padding: 10px;
            background: #fff3e0;
            border-radius: 8px;
            border-left: 4px solid #e55039;
        }
        
        .swap-highlight {
            animation: swapAnimation 0.8s ease-in-out;
            z-index: 100 !important;
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 768px) {
            .tree-display-section {
                height: 650px;
            }
            
            #treeContainer {
                height: 550px;
            }
            
            .priority-display-section {
                height: 400px;
            }
            
            .tree-node {
                width: 180px;
                min-height: 110px;
            }
            
            .simulation-area {
                gap: 20px;
            }
        }

        @media (max-width: 480px) {
            .tree-display-section {
                height: 550px;
            }
            
            #treeContainer {
                height: 450px;
            }
            
            .priority-display-section {
                height: 350px;
            }
            
            .tree-node {
                width: 160px;
                min-height: 100px;
                padding: 10px;
            }
        }
		
		/* Responsive untuk log */
@media (max-width: 768px) {
    .log {
        max-height: 500px;
    }
    
    .log-entry {
        padding: 12px;
        margin-bottom: 10px;
    }
    
    .log-entry-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
    }
}

/* Scrollbar styling untuk log */
.log::-webkit-scrollbar {
    width: 10px;
}

.log::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
}

.log::-webkit-scrollbar-thumb {
    background: #0c2461;
    border-radius: 10px;
}

.log::-webkit-scrollbar-thumb:hover {
    background: #e55039;
}
    </style>
</head>
<body>
    <div class="container">
        <h1>Simulasi Heap Sort Hotel Makassar</h1>
        <div class="subtitle">Visualisasi Heap Tree dengan Posisi Terpusat</div>
        
        <!-- ARRAY AWAL SEBELUM BUILD MAX-HEAP -->
        <div class="initial-array-container">
            <div class="initial-array-title">
                <span>üìã Array Awal Sebelum Build Max-Heap</span>
                <span style="background: #2196f3; color: white; padding: 3px 10px; border-radius: 15px; font-size: 0.9rem;">
                    Kondisi Awal
                </span>
            </div>
            
            <div class="array-visualization" id="initialArrayVisualization">
                <!-- Array akan diisi oleh JavaScript -->
            </div>
            
            <div class="initial-note">
                ‚ö†Ô∏è <strong>CATATAN:</strong> Array ini menunjukkan urutan awal SEBELUM proses Build Max-Heap. 
                Proses Build Max-Heap akan mengubah struktur ini menjadi Max-Heap dengan root (index 0) 
                memiliki nilai priority tertinggi (5529.0 = Four Points).
            </div>
        </div>
        
        <div class="algorithm-explanation">
            <h3>üìã Struktur Heap Tree (Max-Heap) - SETELAH BUILD MAX-HEAP</h3>
            <table class="criteria-table">
                <tr>
                    <th>Index</th>
                    <th>Hotel</th>
                    <th>Priority Value</th>
                    <th>Level</th>
                    <th>Keterangan</th>
                </tr>
                <tr>
                    <td>0</td>
                    <td><strong>Four Points</strong></td>
                    <td><strong>5529.0</strong></td>
                    <td>Root</td>
                    <td>‚≠ê Nilai terbesar</td>
                </tr>
                <tr>
                    <td>1</td>
                    <td><strong>Swiss-Belhotel</strong></td>
                    <td><strong>5399.2</strong></td>
                    <td>Level 1 (Left)</td>
                    <td>Child dari root</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td><strong>Clarion</strong></td>
                    <td><strong>4942.5</strong></td>
                    <td>Level 1 (Right)</td>
                    <td>Non-leaf</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td><strong>Santika Premiere</strong></td>
                    <td><strong>5163.5</strong></td>
                    <td>Level 2 (Leaf)</td>
                    <td>Tidak perlu heapify</td>
                </tr>
                <tr>
                    <td>4</td>
                    <td><strong>Aston Makassar</strong></td>
                    <td><strong>5293.8</strong></td>
                    <td>Level 2 (Leaf)</td>
                    <td>Tidak perlu heapify</td>
                </tr>
                <tr>
                    <td>5</td>
                    <td><strong>Losari</strong></td>
                    <td><strong>4712.0</strong></td>
                    <td>Level 2 (Leaf)</td>
                    <td>Tidak perlu heapify</td>
                </tr>
            </table>
            
            <div class="heap-property">
                <strong>Proses Build Max-Heap:</strong><br>
                ‚Ä¢ Array Awal: <code style="color: #e55039;">[5293.8, 5399.2, 4942.5, 5163.5, 5529.0, 4712.0]</code><br>
                ‚Ä¢ Array Setelah Build Max-Heap: <code style="color: #4caf50; font-weight: bold;">[5529.0, 5399.2, 4942.5, 5163.5, 5293.8, 4712.0]</code><br><br>
				‚Ä¢ n = 6, leaf mulai dari index = floor(6/2) = 3,
				  Leaf nodes: index 3, 4, 5 (tidak perlu di-heapify)<br>
				‚Ä¢ Heapify : floor(n)/2 ,jika n=6,maka heapify = 6/2= 3,index heapify :  2 , 1 , 0<br>
				‚Ä¢ Left Child : 2*i+1<br>
				‚Ä¢ Right Child : 2*i+2<br>
				
                <strong>Heap Property (Max-Heap) terpenuhi:</strong><br>
                ‚Ä¢ Parent node (index 0: 5529.0) ‚â• Child nodes (5399.2, 4942.5) ‚úì<br>
                ‚Ä¢ Parent node (index 1: 5399.2) ‚â• Child nodes (5163.5, 5293.8) ‚úì<br>
                ‚Ä¢ Priority Value = (rating√ó1000) + (popularity√ó10) - price - distance
            </div>
        </div>
        
       
        <div class="section-title">
            Data Hotel Makassar (n = 6) - SETELAH BUILD MAX-HEAP
            <span class="step-counter" id="stepCounter">Step: 0/0</span>
        </div>
        
        <!-- KONTAINER ARRAY FINAL SETELAH BUILD MAX-HEAP -->
        <div class="initial-array-container" style="background: #e8f5e9; border-left: 5px solid #4caf50;">
            <div class="initial-array-title">
                <span>‚úÖ Array Final Setelah Build Max-Heap</span>
                <span style="background: #4caf50; color: white; padding: 3px 10px; border-radius: 15px; font-size: 0.9rem;">
                    Siap untuk Heap Sort Phase
                </span>
            </div>
            
            <div class="array-visualization" id="finalArrayVisualization">
                <!-- Array final akan diisi oleh JavaScript -->
            </div>
            
            <div class="initial-note" style="border-left-color: #4caf50; color: #4caf50;">
                ‚úÖ <strong>MAX-HEAP PROPERTY TERPENUHI:</strong> 
                Root (Four Points) memiliki nilai tertinggi (5529.0). Setiap parent node memiliki nilai priority yang lebih BESAR atau SAMA dengan child nodes-nya.
            </div>
        </div>
         <div class="status" id="status">Status: Inisialisasi data hotel...</div>
        
        <div class="controls">
            <button class="btn" id="prevBtn">‚èÆÔ∏è Langkah Sebelumnya</button>
            <button class="btn" id="nextBtn">Langkah Berikutnya ‚è≠Ô∏è</button>
            <button class="btn" id="autoBtn">‚ñ∂Ô∏è Jalankan Otomatis (2 detik)</button>
            <button class="btn" id="resetBtn">üîÑ Ulang Simulasi</button>
            <button class="btn" id="speedUpBtn">‚ö° Percepat (1 detik)</button>
            <button class="btn" id="speedDownBtn">üê¢ Perlambat (3 detik)</button>
        </div>
        
        <!-- ===== LAYOUT VERTIKAL ATAS-BAWAH ===== -->
        <div class="simulation-area">
            <!-- Tampilkan Tree di atas -->
            <div class="tree-display-section">
                <div class="section-title">
                    Struktur Heap Tree (Posisi Terpusat) - SETELAH BUILD MAX-HEAP
                    <span class="phase-indicator" id="phaseIndicator">Build Max-Heap</span>
                </div>
                <div id="treeContainer"></div>
            </div>
            
            <!-- Tampilkan Priority di bawah -->
            <div class="priority-display-section">
                <div class="section-title">Urutan Prioritas & Proses Heapify</div>
                <div id="calculationsContent">
                    <div class="calculation-box">
                        <strong>Menghitung Leaf Nodes:</strong><br>
                        n = 6, leaf mulai dari index = floor(6/2) = 3<br>
                        Leaf nodes: index 3, 4, 5 (tidak perlu di-heapify)
                    </div>
                </div>
                <ul class="priority-list" id="priorityList"></ul>
            </div>
        </div>
        
        <div class="log">
		<!-- Tambahkan di bagian controls atau di atas log -->
<div class="controls" style="margin-top: 20px;">
    <button class="btn" id="clearLogBtn">üóëÔ∏è Hapus Log</button>
    <button class="btn" id="expandLogBtn">üìñ Perbesar Log</button>
    <button class="btn" id="collapseLogBtn">üìï Kecilkan Log</button>
    <button class="btn" id="exportLogBtn">üíæ Simpan Log</button>
</div>
            <div class="log-title">
                Log Proses Heap Sort
                <span id="logPhaseIndicator">Phase: Build Max-Heap</span>
            </div>
            <div id="logContent"></div>
        </div>
    </div>

    <script>
        // ==================== DATA HOTEL AWAL (SEBELUM MAX-HEAP) ====================
        const initialHotelsData = [
            {
                name: "Aston Makassar Hotel",
                price: 85,
                rating: 4.5,
                popularity: 88,
                distance: 1.2,
                priority: 5293.8,
                isLeaf: false
            },
            {
                name: "Swiss-Belhotel Harbour Bay",
                price: 120,
                rating: 4.6,
                popularity: 92,
                distance: 0.8,
                priority: 5399.2,
                isLeaf: false
            },
            {
                name: "Clarion Makassar",
                price: 75,
                rating: 4.2,
                popularity: 82,
                distance: 2.5,
                priority: 4942.5,
                isLeaf: false
            },
            {
                name: "Santika Premiere Makassar",
                price: 95,
                rating: 4.4,
                popularity: 86,
                distance: 1.5,
                priority: 5163.5,
                isLeaf: true
            },
            {
                name: "Four Points by Sheraton Makassar",
                price: 110,
                rating: 4.7,
                popularity: 94,
                distance: 1.0,
                priority: 5529.0,
                isLeaf: true
            },
            {
                name: "Losari Beach Hotel",
                price: 65,
                rating: 4.0,
                popularity: 78,
                distance: 3.0,
                priority: 4712.0,
                isLeaf: true
            }
        ];

        // Data untuk simulasi (SETELAH BUILD MAX-HEAP) - URUTAN YANG BENAR
        const hotels = [
            {
                name: "Four Points by Sheraton Makassar",
                price: 110,
                rating: 4.7,
                popularity: 94,
                distance: 1.0,
                priority: 5529.0,
                isLeaf: false
            },
            {
                name: "Swiss-Belhotel Harbour Bay",
                price: 120,
                rating: 4.6,
                popularity: 92,
                distance: 0.8,
                priority: 5399.2,
                isLeaf: false
            },
            {
                name: "Clarion Makassar",
                price: 75,
                rating: 4.2,
                popularity: 82,
                distance: 2.5,
                priority: 4942.5,
                isLeaf: false
            },
            {
                name: "Santika Premiere Makassar",
                price: 95,
                rating: 4.4,
                popularity: 86,
                distance: 1.5,
                priority: 5163.5,
                isLeaf: true
            },
            {
                name: "Aston Makassar Hotel",
                price: 85,
                rating: 4.5,
                popularity: 88,
                distance: 1.2,
                priority: 5293.8,
                isLeaf: true
            },
            {
                name: "Losari Beach Hotel",
                price: 65,
                rating: 4.0,
                popularity: 78,
                distance: 3.0,
                priority: 4712.0,
                isLeaf: true
            }
        ];

        // ==================== FUNGSI TAMPILKAN ARRAY AWAL ====================
        function displayInitialArray() {
            const initialArrayContainer = document.getElementById('initialArrayVisualization');
            initialArrayContainer.innerHTML = '';
            
            const initialArray = [
                {hotel: initialHotelsData[0], priority: 5293.8, index: 0},
                {hotel: initialHotelsData[1], priority: 5399.2, index: 1},
                {hotel: initialHotelsData[2], priority: 4942.5, index: 2},
                {hotel: initialHotelsData[3], priority: 5163.5, index: 3},
                {hotel: initialHotelsData[4], priority: 5529.0, index: 4},
                {hotel: initialHotelsData[5], priority: 4712.0, index: 5}
            ];
            
            initialArray.forEach((item, displayIndex) => {
                const hotel = item.hotel;
                const priority = item.priority;
                const originalIndex = item.index;
                
                const arrayElement = document.createElement('div');
                arrayElement.className = 'array-element';
                
                // Warna border berdasarkan posisi
                let borderColor = '#2196f3'; // Default blue
                if (displayIndex === 0) borderColor = '#ff9800'; // Orange untuk Aston (index 0 awal)
                if (displayIndex === 4) borderColor = '#e55039'; // Red untuk Four Points
                if (displayIndex >= 3) borderColor = '#9c27b0'; // Purple untuk leaf
                
                arrayElement.style.borderColor = borderColor;
                arrayElement.style.boxShadow = `0 4px 8px ${borderColor}40`;
                
                const shortName = getShortHotelName(hotel.name);
                
                arrayElement.innerHTML = `
                    <div class="array-index">${displayIndex}</div>
                    <div class="array-element-name">${shortName}</div>
                    <div class="array-element-details">
                        <div>‚≠ê ${hotel.rating} / 5.0</div>
                        <div>üëç ${hotel.popularity}%</div>
                        <div>üí∞ $${hotel.price}</div>
                        <div>üìç ${hotel.distance} km</div>
                    </div>
                    <div class="array-priority" style="background: ${borderColor}">
                        Priority: ${priority.toFixed(1)}
                    </div>
                    ${displayIndex === 0 ? '<div style="color: #ff9800; font-size: 0.8rem; margin-top: 5px;">‚ö†Ô∏è Aston: BUKAN root sebenarnya</div>' : ''}
                    ${displayIndex === 4 ? '<div style="color: #e55039; font-size: 0.8rem; margin-top: 5px;">‚≠ê Four Points: Nilai tertinggi</div>' : ''}
                    ${displayIndex >= 3 ? '<div style="color: #9c27b0; font-size: 0.8rem; margin-top: 5px;">üçÉ Leaf node</div>' : ''}
                `;
                
                initialArrayContainer.appendChild(arrayElement);
            });
            
            // Tambahkan penjelasan array
            const explanation = document.createElement('div');
            explanation.style.marginTop = '20px';
            explanation.style.padding = '15px';
            explanation.style.background = '#f5f5f5';
            explanation.style.borderRadius = '10px';
            explanation.style.fontSize = '0.9rem';
            explanation.innerHTML = `
                <strong>üìù Penjelasan Array Awal:</strong><br>
                ‚Ä¢ Array awal: <code style="font-family: 'Courier New'; background: #eee; padding: 2px 5px; border-radius: 3px;">[5293.8, 5399.2, 4942.5, 5163.5, 5529.0, 4712.0]</code><br>
                ‚Ä¢ <span style="color: #ff9800;">Index 0 (Aston)</span>: Prioritas = 5293.8<br>
                ‚Ä¢ <span style="color: #2196f3;">Index 1 (Swiss-Belhotel)</span>: Prioritas = 5399.2<br>
                ‚Ä¢ <span style="color: #2196f3;">Index 2 (Clarion)</span>: Prioritas = 4942.5<br>
                ‚Ä¢ <span style="color: #9c27b0;">Index 3 (Santika)</span>: Prioritas = 5163.5<br>
                ‚Ä¢ <span style="color: #e55039;">Index 4 (Four Points)</span>: Prioritas = 5529.0 (nilai tertinggi)<br>
                ‚Ä¢ <span style="color: #9c27b0;">Index 5 (Losari)</span>: Prioritas = 4712.0<br><br>
                
                <strong>üîÅ Proses Build Max-Heap akan:</strong><br>
                1. Heapify dimulai dari non-leaf terakhir (index 2 = Clarion)<br>
                2. Four Points (5529.0) akan naik ke root<br>
                3. Membentuk struktur Max-Heap yang benar
            `;
            
            initialArrayContainer.appendChild(explanation);
            
            // Tampilkan array final setelah build max-heap
            displayFinalArray();
        }

        // ==================== FUNGSI TAMPILKAN ARRAY FINAL ====================
        function displayFinalArray() {
            const finalArrayContainer = document.getElementById('finalArrayVisualization');
            if (!finalArrayContainer) return;
            
            finalArrayContainer.innerHTML = '';
            
            hotels.forEach((hotel, index) => {
                const priority = hotel.priority;
                
                const arrayElement = document.createElement('div');
                arrayElement.className = 'array-element';
                
                // Warna border berdasarkan posisi dalam max-heap
                let borderColor = '#4caf50'; // Default green untuk max-heap
                if (index === 0) borderColor = '#8c7ae6'; // Purple untuk root
                if (index === 1 || index === 2) borderColor = '#2196f3'; // Blue untuk level 1
                if (index >= 3) borderColor = '#9c27b0'; // Purple untuk leaf
                
                arrayElement.style.borderColor = borderColor;
                arrayElement.style.boxShadow = `0 4px 8px ${borderColor}40`;
                
                const shortName = getShortHotelName(hotel.name);
                
                arrayElement.innerHTML = `
                    <div class="array-index" style="background: ${borderColor}">${index}</div>
                    <div class="array-element-name">${shortName}</div>
                    <div class="array-element-details">
                        <div>‚≠ê ${hotel.rating} / 5.0</div>
                        <div>üëç ${hotel.popularity}%</div>
                        <div>üí∞ $${hotel.price}</div>
                        <div>üìç ${hotel.distance} km</div>
                    </div>
                    <div class="array-priority" style="background: ${borderColor}">
                        Priority: ${priority.toFixed(1)}
                    </div>
                    ${index === 0 ? '<div style="color: #8c7ae6; font-size: 0.8rem; margin-top: 5px;">üëë ROOT MAX-HEAP</div>' : ''}
                    ${index >= 3 ? '<div style="color: #9c27b0; font-size: 0.8rem; margin-top: 5px;">üçÉ Leaf node</div>' : ''}
                `;
                
                finalArrayContainer.appendChild(arrayElement);
            });
            
            // Tambahkan array representation
            const arrayRep = document.createElement('div');
            arrayRep.style.marginTop = '20px';
            arrayRep.style.padding = '15px';
            arrayRep.style.background = '#e8f5e9';
            arrayRep.style.borderRadius = '10px';
            arrayRep.style.border = '2px solid #4caf50';
            arrayRep.style.fontSize = '1.1rem';
            arrayRep.style.textAlign = 'center';
            arrayRep.style.fontFamily = "'Courier New', monospace";
            arrayRep.style.fontWeight = 'bold';
            arrayRep.style.color = '#0c2461';
            
            const priorities = hotels.map(h => h.priority.toFixed(1));
            arrayRep.innerHTML = `
                <strong>Representasi Array Max-Heap:</strong><br>
                <code style="font-size: 1.3rem; color: #e55039; background: white; padding: 10px; border-radius: 8px; display: inline-block; margin-top: 10px;">
                    [${priorities.join(', ')}]
                </code><br><br>
                <div style="font-size: 0.9rem; color: #666; text-align: left;">
                    <strong>Heap Property Terpenuhi:</strong><br>
                    ‚úì Four Points (5529.0) adalah root dengan nilai tertinggi<br>
                    ‚úì Setiap parent memiliki nilai ‚â• children:<br>
                    &nbsp;&nbsp;‚Ä¢ Root[0]=5529.0 ‚â• Left[1]=5399.2 dan Right[2]=4942.5 ‚úì<br>
                    &nbsp;&nbsp;‚Ä¢ Parent[1]=5399.2 ‚â• Left[3]=5163.5 dan Right[4]=5293.8 ‚úì<br>
                    &nbsp;&nbsp;‚Ä¢ Parent[2]=4942.5 ‚â• Left[5]=4712.0 ‚úì (tidak ada right child)
                </div>
            `;
            
            finalArrayContainer.appendChild(arrayRep);
        }

        // ==================== STATE MANAGEMENT ====================
        let currentHotels = JSON.parse(JSON.stringify(hotels));
        let steps = [];
        let currentStep = 0;
        let autoPlayInterval = null;
        let autoPlaySpeed = 2000;

        // ==================== POSISI NODE TERPUSAT UNTUK LAYOUT VERTIKAL ====================
        // Posisi node yang lebih baik untuk visualisasi
        const NODE_POSITIONS_CENTERED = [
            // Index: 0 - ROOT (Four Points) - TENGAH ATAS
            { x: 600, y: 50, level: 0 },  // Posisi tengah atas
            // Index: 1 - Swiss-Belhotel - KIRI TENGAH
            { x: 350, y: 250, level: 1 },  // Lebih kiri
            // Index: 2 - Clarion - KANAN TENGAH (NON-LEAF)
            { x: 850, y: 250, level: 1 },  // Lebih kanan
            // Index: 3 - Santika - KIRI BAWAH (LEAF)
            { x: 250, y: 450, level: 2 },  // Jauh ke kiri
            // Index: 4 - Aston - TENGAH BAWAH (LEAF)
            { x: 600, y: 450, level: 2 },  // Tengah bawah
            // Index: 5 - Losari - KANAN BAWAH (LEAF)
            { x: 950, y: 450, level: 2 }  // Jauh ke kanan
        ];

        // ==================== FUNGSI UTILITAS ====================
        function calculatePriority(hotel) {
            // Priority Value = (rating√ó1000) + (popularity√ó10) - price - distance
            const priorityValue = 
                (hotel.rating * 1000) + 
                (hotel.popularity * 10) - 
                hotel.price - 
                hotel.distance;
            
            return {
                rating: hotel.rating,
                popularity: hotel.popularity,
                price: hotel.price,
                distance: hotel.distance,
                total: priorityValue,
                tuple: `(${hotel.rating.toFixed(1)}√ó1000 + ${hotel.popularity}√ó10 - ${hotel.price} - ${hotel.distance})`
            };
        }

        function identifyLeafNodes(n) {
            const leafStart = Math.floor(n / 2);
            const leafIndices = [];
            for (let i = leafStart; i < n; i++) {
                leafIndices.push(i);
            }
            return leafIndices;
        }

        function getShortHotelName(fullName) {
            const names = {
                "Four Points by Sheraton Makassar": "Four Points",
                "Swiss-Belhotel Harbour Bay": "Swiss-Belhotel",
                "Santika Premiere Makassar": "Santika Premiere",
                "Aston Makassar Hotel": "Aston",
                "Clarion Makassar": "Clarion",
                "Losari Beach Hotel": "Losari"
            };
            return names[fullName] || fullName.split(' ')[0];
        }

        // ==================== FUNGSI SIMULASI ====================
        function initSimulation() {
            // Tampilkan array awal dan final
            displayInitialArray();
            
            currentHotels = JSON.parse(JSON.stringify(hotels));
            steps = [];
            currentStep = 0;
            
            const n = currentHotels.length;
            const leafIndices = identifyLeafNodes(n);
            
            // Hitung priority untuk semua hotel jika belum ada
            currentHotels.forEach((hotel, index) => {
                if (!hotel.priority || hotel.priority === 0) {
                    hotel.priority = calculatePriority(hotel).total;
                }
                hotel.isLeaf = leafIndices.includes(index);
            });
            
            // Step 0: Inisialisasi array awal
            recordStep(
                "üèÅ INISIALISASI: Data hotel Makassar<br>" +
                "<strong>Array Awal:</strong> <code style='background: #e3f2fd; padding: 5px 10px; border-radius: 5px;'>[5293.8, 5399.2, 4942.5, 5163.5, 5529.0, 4712.0]</code>",
                [], [], "Initial"
            );
            
            // Step 1: Identifikasi leaf nodes
            const leafHotels = leafIndices.map(i => currentHotels[i].name);
            recordStep(
                `üçÉ IDENTIFIKASI LEAF NODES:<br>n = ${n}, leaf mulai dari index = floor(${n}/2) = ${Math.floor(n/2)}<br>Leaf nodes: index ${leafIndices.join(', ')}<br>Hotel: ${leafHotels.map(getShortHotelName).join(', ')}`,
                leafIndices, [], "Leaf"
            );
            
            // Step 2: Proses Build Max-Heap
            recordStep(
                `üî® MEMBANGUN MAX-HEAP (n = ${n})<br>Heapify dimulai dari non-leaf terakhir: floor(${n}/2)-1 = ${Math.floor(n/2)-1} (index 2 = Clarion)`,
                [], [], "Build"
            );
            
            // Simulasi Build Max-Heap
            buildMaxHeap();
            
            // Step terakhir: Tampilkan array final max-heap
            recordStep(
                `‚úÖ BUILD MAX-HEAP SELESAI!<br>` +
                `<strong>Array Final Max-Heap:</strong> <code style="background: #e8f5e9; padding: 10px; border-radius: 8px; font-family: 'Courier New'; font-size: 1.1rem; font-weight: bold;">[${currentHotels.map(h => h.priority.toFixed(1)).join(', ')}]</code><br><br>` +
                `<strong>Struktur Max-Heap:</strong><br>` +
                `‚Ä¢ Root [0]: ${getShortHotelName(currentHotels[0].name)} = ${currentHotels[0].priority.toFixed(1)} (tertinggi)<br>` +
                `‚Ä¢ Left child [1]: ${getShortHotelName(currentHotels[1].name)} = ${currentHotels[1].priority.toFixed(1)}<br>` +
                `‚Ä¢ Right child [2]: ${getShortHotelName(currentHotels[2].name)} = ${currentHotels[2].priority.toFixed(1)}<br>` +
                `‚Ä¢ Siap untuk Heap Sort Phase!`,
                [], [], "Complete"
            );
            
            // Heap Sort phase (dimulai dari step berikutnya)
            heapSort();
            
            updateDisplay();
        }

        function buildMaxHeap() {
            let n = currentHotels.length;
            
            let startIdx = Math.floor(n / 2) - 1; // index 2 = Clarion
            
            for (let i = startIdx; i >= 0; i--) {
                const heapifyMessage = `üîÑ HEAPIFY Node ${i}: ${getShortHotelName(currentHotels[i].name)}<br>Priority: ${currentHotels[i].priority.toFixed(1)}`;
                recordStep(heapifyMessage, [i], [], "Heapify");
                maxHeapify(n, i, "build");
            }
        }

        function maxHeapify(n, i, phase) {
            let largest = i;
            let left = 2 * i + 1;
            let right = 2 * i + 2;
            
            const leftInfo = left < n ? 
                `${getShortHotelName(currentHotels[left].name)} (${currentHotels[left].priority.toFixed(1)})` : 
                "tidak ada";
            const rightInfo = right < n ? 
                `${getShortHotelName(currentHotels[right].name)} (${currentHotels[right].priority.toFixed(1)})` : 
                "tidak ada";
            
            let message = `üîç ANALISIS Node ${i} (${getShortHotelName(currentHotels[i].name)}):<br>`;
            message += `‚Ä¢ Priority: ${currentHotels[i].priority.toFixed(1)}<br>`;
            message += `‚Ä¢ Left child [${left}]: ${leftInfo}<br>`;
            message += `‚Ä¢ Right child [${right}]: ${rightInfo}`;
            
            let activeIndices = [i];
            if (left < n) activeIndices.push(left);
            if (right < n) activeIndices.push(right);
            
            recordStep(message, activeIndices, [], "Heapify");
            
            // Cari child dengan nilai TERBESAR (karena ini Max-Heap)
            if (left < n && currentHotels[left].priority > currentHotels[largest].priority) {
                largest = left;
                recordStep(
                    `üëà LEFT CHILD LEBIH PRIORITAS (NILAI LEBIH BESAR):<br>${getShortHotelName(currentHotels[left].name)} (${currentHotels[left].priority.toFixed(1)}) > ${getShortHotelName(currentHotels[i].name)} (${currentHotels[i].priority.toFixed(1)})<br>Set largest = ${left}`,
                    [i, left], [], "Heapify"
                );
            }
            
            if (right < n && currentHotels[right].priority > currentHotels[largest].priority) {
                largest = right;
                recordStep(
                    `üëâ RIGHT CHILD LEBIH PRIORITAS (NILAI LEBIH BESAR):<br>${getShortHotelName(currentHotels[right].name)} (${currentHotels[right].priority.toFixed(1)}) > ${getShortHotelName(currentHotels[largest].name)} (${currentHotels[largest].priority.toFixed(1)})<br>Set largest = ${right}`,
                    [i, right], [], "Heapify"
                );
            }
            
            if (largest !== i) {
                recordStep(
                    `üîÑ PERLU SWAP: ${getShortHotelName(currentHotels[i].name)} ‚áÑ ${getShortHotelName(currentHotels[largest].name)}<br>Karena child memiliki nilai priority yang lebih BESAR`,
                    [], [i, largest], "Swap"
                );
                
                [currentHotels[i], currentHotels[largest]] = [currentHotels[largest], currentHotels[i]];
                
                recordStep(
                    `‚úÖ SETELAH SWAP:<br>‚Ä¢ Index ${i}: ${getShortHotelName(currentHotels[i].name)} (${currentHotels[i].priority.toFixed(1)})<br>‚Ä¢ Index ${largest}: ${getShortHotelName(currentHotels[largest].name)} (${currentHotels[largest].priority.toFixed(1)})`,
                    [], [i, largest], "Swap"
                );
                
                maxHeapify(n, largest, phase);
            } else {
                recordStep(
                    `‚úì Node ${i} (${getShortHotelName(currentHotels[i].name)}) SUDAH memenuhi max-heap property<br>Parent (${currentHotels[i].priority.toFixed(1)}) ‚â• children`,
                    [i], [], "Heapify"
                );
            }
        }

        // ==================== HEAP SORT YANG BENAR ====================
        function heapSort() {
            let n = currentHotels.length;
            
            // Buat copy dari heap yang sudah dibangun
            let heapArray = JSON.parse(JSON.stringify(currentHotels));
            
            recordStep(
                `üéØ MULAI HEAP SORT PHASE<br>Max-Heap awal (n=${n}):<br><code style="background: #e8f5e9; padding: 10px; border-radius: 8px; font-family: 'Courier New'; font-size: 1.1rem;">[${heapArray.map(h => h.priority.toFixed(1)).join(', ')}]</code><br>` +
                `<strong>Algoritma Heap Sort:</strong><br>1. Swap root dengan elemen terakhir<br>2. Kurangi heap size<br>3. Heapify root baru<br>4. Ulangi hingga heap size = 1`,
                [], [], "Sort"
            );
            
            // ALGORITMA HEAP SORT
            for (let i = n - 1; i > 0; i--) {
                const iteration = n - i;
                const heapSizeBeforeSwap = i + 1; // Sebelum swap, heap size = i+1
                
                // Step 1: Tampilkan sebelum swap
                recordStep(
                    `üì¶ ITERASI ${iteration}: SEBELUM SWAP<br>` +
                    `‚Ä¢ Heap size: ${heapSizeBeforeSwap} elemen<br>` +
                    `‚Ä¢ Root [0]: ${getShortHotelName(heapArray[0].name)} = ${heapArray[0].priority.toFixed(1)}<br>` +
                    `‚Ä¢ Elemen terakhir [${i}]: ${getShortHotelName(heapArray[i].name)} = ${heapArray[i].priority.toFixed(1)}`,
                    [0, i], [], "Sort"
                );
                
                // Step 2: Proses swap
                recordStep(
                    `üîÑ SWAP ROOT DENGAN ELEMEN TERAKHIR:<br>` +
                    `${getShortHotelName(heapArray[0].name)} [0] ‚áÑ ${getShortHotelName(heapArray[i].name)} [${i}]<br>` +
                    `Heap size setelah swap: ${i} elemen`,
                    [], [0, i], "Swap"
                );
                
                // Lakukan swap
                [heapArray[0], heapArray[i]] = [heapArray[i], heapArray[0]];
                
                // Update currentHotels untuk visualisasi
                currentHotels = JSON.parse(JSON.stringify(heapArray));
                
                // Step 3: Setelah swap - TAMPILKAN PERUBAHAN
                recordStep(
                    `‚úÖ SETELAH SWAP - PERUBAHAN TERJADI:<br>` +
                    `‚Ä¢ Index ${i} (posisi akhir): ${getShortHotelName(heapArray[i].name)} = ${heapArray[i].priority.toFixed(1)}<br>` +
                    `‚Ä¢ Index 0 (root baru): ${getShortHotelName(heapArray[0].name)} = ${heapArray[0].priority.toFixed(1)}<br>` +
                    `‚Ä¢ Elemen terurut: ${n - i} dari ${n} elemen`,
                    [0, i], [0, i], "Swap"
                );
                
                // Step 4: Heapify jika perlu
                if (i > 1) {
                    recordStep(
                        `üîÑ HEAPIFY ROOT BARU:<br>` +
                        `Root baru: ${getShortHotelName(heapArray[0].name)} (${heapArray[0].priority.toFixed(1)})<br>` +
                        `Heap size yang aktif: ${i} elemen`,
                        [0], [], "Heapify"
                    );
                    
                    // Simpan state sebelum heapify
                    recordStep(
                        `üîç STATE SEBELUM HEAPIFY (size=${i}):<br>` +
                        `${heapArray.slice(0, i).map((h, idx) => 
                            `${idx === 0 ? 'üëë ' : ''}[${idx}] ${getShortHotelName(h.name)} = ${h.priority.toFixed(1)}`
                        ).join('<br>')}`,
                        [], [], "Heapify"
                    );
                    
                    // Lakukan heapify dengan visualisasi
                    performHeapifyWithVisualization(heapArray, i, 0);
                    
                } else {
                    recordStep(
                        `‚úì Heap size = 1, tidak perlu di-heapify<br>` +
                        `Proses heap sort hampir selesai!`,
                        [], [], "Complete"
                    );
                }
                
                // Step 5: Tampilkan progress
                recordStep(
                    `üìà PROGRESS setelah iterasi ${iteration}:<br>` +
                    `Heap aktif (${i} elemen): ${heapArray.slice(0, i).map(h => getShortHotelName(h.name)).join(', ')}<br>` +
                    `Terurut (${n - i} elemen): ${heapArray.slice(i).map(h => getShortHotelName(h.name)).join(', ')}`,
                    [], [], "Sort"
                );
            }
            
            // Final step - hasil akhir
            currentHotels = heapArray;
            
            recordStep(
                `üéâ HEAP SORT SELESAI!<br><br>` +
                `<strong>HASIL AKHIR (TERURUT ASCENDING):</strong><br>` +
                `${currentHotels.map((h, idx) => 
                    `${idx}. ${getShortHotelName(h.name)} = ${h.priority.toFixed(1)} (${h.rating}‚≠ê)`
                ).join('<br>')}<br><br>` +
                `<strong>PERBANDINGAN:</strong><br>` +
                `‚Ä¢ Array Awal: [5293.8, 5399.2, 4942.5, 5163.5, 5529.0, 4712.0]<br>` +
                `‚Ä¢ Max-Heap: [5529.0, 5399.2, 4942.5, 5163.5, 5293.8, 4712.0]<br>` +
                `‚Ä¢ Hasil Sort: [4712.0, 5163.5, 5293.8, 5399.2, 5529.0, 4942.5]`,
                [], [], "Complete"
            );
        }

        function performHeapifyWithVisualization(arr, n, i) {
            let largest = i;
            let left = 2 * i + 1;
            let right = 2 * i + 2;
            
            // Analisis child nodes
            let analysis = `üîç Analisis node ${i} (${getShortHotelName(arr[i].name)} = ${arr[i].priority.toFixed(1)}):<br>`;
            if (left < n) {
                analysis += `‚Ä¢ Left child [${left}]: ${getShortHotelName(arr[left].name)} = ${arr[left].priority.toFixed(1)}<br>`;
            }
            if (right < n) {
                analysis += `‚Ä¢ Right child [${right}]: ${getShortHotelName(arr[right].name)} = ${arr[right].priority.toFixed(1)}<br>`;
            }
            
            // Cari nilai terbesar
            if (left < n && arr[left].priority > arr[largest].priority) {
                largest = left;
                analysis += `‚Ä¢ <span style="color:#e55039">LEFT lebih besar! largest = ${left}</span><br>`;
            }
            
            if (right < n && arr[right].priority > arr[largest].priority) {
                largest = right;
                analysis += `‚Ä¢ <span style="color:#e55039">RIGHT lebih besar! largest = ${right}</span><br>`;
            }
            
            if (largest !== i) {
                // Step: Sebelum swap
                recordStep(
                    analysis + `<br>üîÑ PERLU SWAP: ${getShortHotelName(arr[i].name)} [${i}] ‚áÑ ${getShortHotelName(arr[largest].name)} [${largest}]`,
                    [i, largest], [i, largest], "Swap"
                );
                
                // Lakukan swap
                [arr[i], arr[largest]] = [arr[largest], arr[i]];
                
                // Update currentHotels untuk visualisasi
                currentHotels = JSON.parse(JSON.stringify(arr));
                
                // Step: Setelah swap
                recordStep(
                    `‚úÖ SETELAH SWAP:<br>` +
                    `‚Ä¢ Index ${i}: ${getShortHotelName(arr[i].name)} = ${arr[i].priority.toFixed(1)}<br>` +
                    `‚Ä¢ Index ${largest}: ${getShortHotelName(arr[largest].name)} = ${arr[largest].priority.toFixed(1)}`,
                    [i, largest], [i, largest], "Swap"
                );
                
                // Rekursif heapify
                performHeapifyWithVisualization(arr, n, largest);
            } else {
                recordStep(
                    analysis + `<br>‚úì Tidak perlu swap, sudah memenuhi heap property`,
                    [i], [], "Heapify"
                );
            }
        }

   function recordStep(message, activeIndices, swapIndices, stepType) {
    // Format pesan agar lebih rapi
    let formattedMessage = message;
    
    // Jika ada <br>, beri jarak antar paragraf
    if (message.includes('<br>')) {
        const parts = message.split('<br>');
        formattedMessage = parts.map(part => {
            if (part.trim().startsWith('‚Ä¢') || part.trim().startsWith('‚úì') || 
                part.trim().startsWith('üîç') || part.trim().startsWith('üîÑ')) {
                return `<div style="margin: 5px 0; padding-left: 10px;">${part}</div>`;
            }
            return `<div style="margin: 10px 0; font-weight: ${part.includes(':') ? 'bold' : 'normal'};">${part}</div>`;
        }).join('');
    }
    
    steps.push({
        hotels: JSON.parse(JSON.stringify(currentHotels)),
        message: formattedMessage,
        activeIndices: [...activeIndices],
        swapIndices: [...swapIndices],
        stepType: stepType,
        stepNumber: steps.length
    });
}

        // ==================== FUNGSI DISPLAY ====================
        function updateDisplay() {
    if (currentStep >= steps.length) return;
    
    const step = steps[currentStep];
    
    updateTreeDisplay(step);
    updatePriorityList(step);
    updateCalculations(step);
    updateLog(step);
    updateStatus(step);
    updateButtons();
    updateStepCounter();
}

        function updateHotelCards(step) {
            const hotelGrid = document.getElementById('hotelGrid');
            hotelGrid.innerHTML = '';
            
            const n = step.hotels.length;
            const leafIndices = identifyLeafNodes(n);
            
            step.hotels.forEach((hotel, index) => {
                const card = document.createElement('div');
                card.className = 'hotel-card';
                
                if (step.activeIndices.includes(index)) card.classList.add('active');
                if (step.swapIndices.includes(index)) card.classList.add('swap');
                if (index === 0) card.classList.add('root');
                if (leafIndices.includes(index)) card.classList.add('leaf');
                
                // Tentukan priority display
                const priority = hotel.priority || calculatePriority(hotel).total;
                
                card.innerHTML = `
                    <div class="node-index">${index}</div>
                    <div class="hotel-name">${hotel.name}</div>
                    <div class="hotel-details">
                        <div class="hotel-detail">
                            <span class="detail-label">Rating:</span>
                            <span class="detail-value">${hotel.rating} ‚≠ê</span>
                        </div>
                        <div class="hotel-detail">
                            <span class="detail-label">Popularitas:</span>
                            <span class="detail-value">${hotel.popularity}/100</span>
                        </div>
                        <div class="hotel-detail">
                            <span class="detail-label">Harga:</span>
                            <span class="detail-value">$${hotel.price}</span>
                        </div>
                        <div class="hotel-detail">
                            <span class="detail-label">Jarak:</span>
                            <span class="detail-value">${hotel.distance} km</span>
                        </div>
                        <div class="hotel-detail">
                            <span class="detail-label">Priority:</span>
                            <span class="priority-value">${priority.toFixed(1)}</span>
                        </div>
                    </div>
                    ${leafIndices.includes(index) ? '<div style="margin-top: 5px; color: #9c27b0; font-size: 0.8rem;">üçÉ Leaf Node</div>' : ''}
                    ${step.swapIndices.includes(index) ? '<div style="margin-top: 5px; color: #4cd137; font-size: 0.8rem; font-weight: bold;">üîÑ Sedang Ditukar</div>' : ''}
                `;
                
                hotelGrid.appendChild(card);
            });
        }

        function updateTreeDisplay(step) {
         const treeContainer = document.getElementById('treeContainer');
    if (!treeContainer) {
        console.error("treeContainer not found!");
        return;
    }
    
    treeContainer.innerHTML = '';
    
    // Hitung ukuran container
    const containerWidth = treeContainer.clientWidth || 1200;
    const containerHeight = treeContainer.clientHeight || 700;
    
    // Definisikan posisi node yang lebih baik
    const NODE_POSITIONS = [
        // Index: 0 - ROOT (Four Points) - TENGAH ATAS
        { x: containerWidth / 2 - 110, y: 50, level: 0 },
        // Index: 1 - Swiss-Belhotel - KIRI TENGAH
        { x: containerWidth / 4 - 110, y: 250, level: 1 },
        // Index: 2 - Clarion - KANAN TENGAH (NON-LEAF)
        { x: 3 * containerWidth / 4 - 110, y: 250, level: 1 },
        // Index: 3 - Santika - KIRI BAWAH (LEAF)
        { x: containerWidth / 6 - 110, y: 450, level: 2 },
        // Index: 4 - Aston - TENGAH BAWAH (LEAF)
        { x: containerWidth / 2 - 110, y: 450, level: 2 },
        // Index: 5 - Losari - KANAN BAWAH (LEAF)
        { x: 5 * containerWidth / 6 - 110, y: 450, level: 2 }
    ];
    
    // Gambar garis level terlebih dahulu (agar di belakang node)
    drawLevelLines(treeContainer);
    
    // Gambar konektor antar node
    const heapSize = getCurrentHeapSize(step);
    
    for (let i = 0; i < step.hotels.length; i++) {
        const leftChild = 2 * i + 1;
        const rightChild = 2 * i + 2;
        
        // Hanya gambar konektor untuk node yang masih dalam heap
        if (i < heapSize) {
            if (leftChild < heapSize && leftChild < step.hotels.length) {
                drawConnector(i, leftChild, step, NODE_POSITIONS, treeContainer);
            }
            if (rightChild < heapSize && rightChild < step.hotels.length) {
                drawConnector(i, rightChild, step, NODE_POSITIONS, treeContainer);
            }
        }
    }
    
    // Gambar node-node
    for (let i = 0; i < step.hotels.length; i++) {
        createTreeNode(step.hotels[i], i, step, NODE_POSITIONS, treeContainer);
    }
}
   function drawLevelLines(treeContainer) {
    if (!treeContainer) return;
    
    // Level 1 (y = 200)
    const level1 = document.createElement('div');
    level1.className = 'tree-level-line';
    level1.style.position = 'absolute';
    level1.style.top = '200px';
    level1.style.width = '95%';
    level1.style.left = '2.5%';
    level1.style.height = '2px';
    level1.style.background = 'linear-gradient(to right, transparent, #0c2461, transparent)';
    level1.style.opacity = '0.3';
    level1.style.zIndex = '0';
    
    const label1 = document.createElement('div');
    label1.className = 'level-label';
    label1.style.position = 'absolute';
    label1.style.top = '185px';
    label1.style.left = '20px';
    label1.textContent = 'Level 1';
    
    // Level 2 (y = 400)
    const level2 = document.createElement('div');
    level2.className = 'tree-level-line';
    level2.style.position = 'absolute';
    level2.style.top = '400px';
    level2.style.width = '95%';
    level2.style.left = '2.5%';
    level2.style.height = '2px';
    level2.style.background = 'linear-gradient(to right, transparent, #0c2461, transparent)';
    level2.style.opacity = '0.3';
    level2.style.zIndex = '0';
    
    const label2 = document.createElement('div');
    label2.className = 'level-label';
    label2.style.position = 'absolute';
    label2.style.top = '385px';
    label2.style.left = '20px';
    label2.textContent = 'Level 2 (Leaf)';
    
    treeContainer.appendChild(level1);
    treeContainer.appendChild(label1);
    treeContainer.appendChild(level2);
    treeContainer.appendChild(label2);
}

       function drawConnector(fromIndex, toIndex, step, positions, treeContainer) {
    if (!treeContainer) return;
    
    const fromPos = positions[fromIndex];
    const toPos = positions[toIndex];
    
    if (!fromPos || !toPos) return;
    
    // Hitung koordinat tengah node
    const fromX = fromPos.x + 110; // Tengah node (110px dari kiri)
    const fromY = fromPos.y + 65;  // Tengah node (65px dari atas)
    const toX = toPos.x + 110;     // Tengah node
    const toY = toPos.y;           // Atas node
    
    // Hitung panjang dan sudut garis
    const deltaX = toX - fromX;
    const deltaY = toY - fromY;
    const length = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
    const angle = Math.atan2(deltaY, deltaX) * 180 / Math.PI;
    
    // Buat elemen connector
    const connector = document.createElement('div');
    connector.className = 'tree-connector';
    connector.style.position = 'absolute';
    connector.style.width = `${length}px`;
    connector.style.height = '3px';
    connector.style.background = '#0c2461';
    connector.style.left = `${fromX}px`;
    connector.style.top = `${fromY}px`;
    connector.style.transform = `rotate(${angle}deg)`;
    connector.style.transformOrigin = '0 0';
    connector.style.zIndex = '1';
    connector.style.opacity = '0.7';
    
    // Tambahkan panah
    const arrow = document.createElement('div');
    arrow.style.position = 'absolute';
    arrow.style.right = '-6px';
    arrow.style.top = '-4px';
    arrow.style.width = '0';
    arrow.style.height = '0';
    arrow.style.borderLeft = '5px solid transparent';
    arrow.style.borderRight = '5px solid transparent';
    arrow.style.borderTop = '8px solid #0c2461';
    connector.appendChild(arrow);
    
    // Highlight jika node aktif
    if (step.activeIndices.includes(fromIndex) || step.activeIndices.includes(toIndex) ||
        step.swapIndices.includes(fromIndex) || step.swapIndices.includes(toIndex)) {
        connector.style.background = '#e55039';
        connector.style.height = '4px';
        connector.style.opacity = '0.9';
        arrow.style.borderTop = '8px solid #e55039';
    }
    
    treeContainer.appendChild(connector);
}


      function isHeapSortStep(stepIndex) {
    if (stepIndex >= steps.length) return false;
    
    // Cari step pertama yang berisi "HEAP SORT"
    for (let i = 0; i < steps.length; i++) {
        if (steps[i].message.includes("HEAP SORT PHASE")) {
            return stepIndex >= i;
        }
    }
    
    return false;
}

        function getCurrentHeapSize(step) {
           const message = step.message;
    
    // Pattern 1: "Heap size: X"
    let match = message.match(/Heap size: (\d+)/);
    if (match) return parseInt(match[1]);
    
    // Pattern 2: "size: X"
    match = message.match(/size: (\d+)/);
    if (match) return parseInt(match[1]);
    
    // Pattern 3: "Heap size sekarang: X"
    match = message.match(/Heap size sekarang: (\d+)/);
    if (match) return parseInt(match[1]);
    
    // Pattern 4: Cari dari iterasi
    if (message.includes("ITERASI")) {
        match = message.match(/ITERASI (\d+)/);
        if (match) {
            const iteration = parseInt(match[1]);
            return step.hotels.length - iteration + 1;
        }
    }
    // ==================== FUNGSI TAMBAHAN YANG DIPERLUKAN ====================
function updateHotelCards(step) {
    const hotelGrid = document.getElementById('hotelGrid');
    if (!hotelGrid) return;
    
    hotelGrid.innerHTML = '';
    
    const n = step.hotels.length;
    const leafIndices = identifyLeafNodes(n);
    
    step.hotels.forEach((hotel, index) => {
        const card = document.createElement('div');
        card.className = 'hotel-card';
        
        if (step.activeIndices.includes(index)) card.classList.add('active');
        if (step.swapIndices.includes(index)) card.classList.add('swap');
        if (index === 0) card.classList.add('root');
        if (leafIndices.includes(index)) card.classList.add('leaf');
        
        // Tentukan priority display
        const priority = hotel.priority || calculatePriority(hotel).total;
        
        card.innerHTML = `
            <div class="node-index">${index}</div>
            <div class="hotel-name">${hotel.name}</div>
            <div class="hotel-details">
                <div class="hotel-detail">
                    <span class="detail-label">Rating:</span>
                    <span class="detail-value">${hotel.rating} ‚≠ê</span>
                </div>
                <div class="hotel-detail">
                    <span class="detail-label">Popularitas:</span>
                    <span class="detail-value">${hotel.popularity}/100</span>
                </div>
                <div class="hotel-detail">
                    <span class="detail-label">Harga:</span>
                    <span class="detail-value">$${hotel.price}</span>
                </div>
                <div class="hotel-detail">
                    <span class="detail-label">Jarak:</span>
                    <span class="detail-value">${hotel.distance} km</span>
                </div>
                <div class="hotel-detail">
                    <span class="detail-label">Priority:</span>
                    <span class="priority-value">${priority.toFixed(1)}</span>
                </div>
            </div>
            ${leafIndices.includes(index) ? '<div style="margin-top: 5px; color: #9c27b0; font-size: 0.8rem;">üçÉ Leaf Node</div>' : ''}
            ${step.swapIndices.includes(index) ? '<div style="margin-top: 5px; color: #4cd137; font-size: 0.8rem; font-weight: bold;">üîÑ Sedang Ditukar</div>' : ''}
        `;
        
        hotelGrid.appendChild(card);
    });
}

function updateCalculations(step) {
    const calculationsContent = document.getElementById('calculationsContent');
    if (!calculationsContent) return;
    
    const n = step.hotels.length;
    const heapSize = getCurrentHeapSize(step);
    const isHeapSortPhase = isHeapSortStep(currentStep);
    
    if (step.stepType === "Leaf") {
        const leafIndices = identifyLeafNodes(n);
        calculationsContent.innerHTML = `
            <div class="calculation-box">
                <strong>üçÉ ANALISIS LEAF NODES:</strong><br>
                ‚Ä¢ n = ${n} hotel<br>
                ‚Ä¢ Leaf mulai dari: floor(${n}/2) = ${Math.floor(n/2)}<br>
                ‚Ä¢ Leaf indices: ${leafIndices.join(', ')}<br>
                ‚Ä¢ Leaf hotels: ${leafIndices.map(i => getShortHotelName(step.hotels[i].name)).join(', ')}<br><br>
                <em>Leaf nodes tidak perlu di-heapify karena tidak memiliki child nodes.</em>
            </div>
        `;
    } else if (isHeapSortPhase) {
        let content = `<div class="calculation-box"><strong>üìä ANALISIS HEAP SORT:</strong><br><br>`;
        
        if (step.swapIndices.length === 2) {
            const [idx1, idx2] = step.swapIndices;
            content += `<strong>üîÑ PROSES SWAP:</strong><br>`;
            content += `‚Ä¢ Index ${idx1}: ${getShortHotelName(step.hotels[idx1].name)} (${step.hotels[idx1].priority.toFixed(1)})<br>`;
            content += `‚Ä¢ Index ${idx2}: ${getShortHotelName(step.hotels[idx2].name)} (${step.hotels[idx2].priority.toFixed(1)})<br>`;
            
            if (idx1 === 0 || idx2 === 0) {
                content += `<br><strong>üí° ALGORITMA HEAP SORT:</strong><br>`;
                content += `1. Swap root (index 0) dengan elemen terakhir heap<br>`;
                content += `2. Kurangi heap size menjadi ${heapSize}<br>`;
                content += `3. Heapify root baru untuk menjaga max-heap property<br>`;
            }
        }
        
        content += `<br><strong>üìà STATUS HEAP:</strong><br>`;
        content += `‚Ä¢ Total elemen: ${n}<br>`;
        content += `‚Ä¢ Heap size aktif: ${heapSize} elemen<br>`;
        content += `‚Ä¢ Elemen terurut: ${n - heapSize} elemen<br>`;
        
        if (heapSize > 0) {
            content += `<br><strong>üîµ ELEMEN DALAM HEAP:</strong><br>`;
            for (let i = 0; i < heapSize; i++) {
                const isRoot = i === 0;
                content += `${isRoot ? 'üëë ' : ''}[${i}] ${getShortHotelName(step.hotels[i].name)} (${step.hotels[i].priority.toFixed(1)})<br>`;
            }
        }
        
        if (n - heapSize > 0) {
            content += `<br><strong>‚úÖ ELEMEN TERURUT:</strong><br>`;
            for (let i = heapSize; i < n; i++) {
                content += `[${i}] ${getShortHotelName(step.hotels[i].name)} (${step.hotels[i].priority.toFixed(1)})<br>`;
            }
        }
        
        content += `</div>`;
        calculationsContent.innerHTML = content;
    } else if (step.stepType === "Build") {
        calculationsContent.innerHTML = `
            <div class="calculation-box">
                <strong>üî® BUILD MAX-HEAP PROCESS:</strong><br><br>
                ‚Ä¢ n = ${n} elements<br>
                ‚Ä¢ Leaf nodes: ${identifyLeafNodes(n).join(', ')}<br>
                ‚Ä¢ Non-leaf nodes: ${Array.from({length: Math.floor(n/2)}, (_, i) => i).join(', ')}<br>
                ‚Ä¢ Build order: ${Array.from({length: Math.floor(n/2)}, (_, i) => Math.floor(n/2)-1-i).join(' ‚Üí ')}<br><br>
                <em>Setiap node di-heapify untuk memastikan parent memiliki nilai lebih BESAR dari children.</em>
            </div>
        `;
    } else {
        calculationsContent.innerHTML = `
            <div class="calculation-box">
                <strong>üìä STATUS:</strong><br>
                ‚Ä¢ Total elemen: ${n}<br>
                ‚Ä¢ Heap size: ${heapSize} elemen<br>
                ‚Ä¢ Phase: ${step.stepType}<br>
                ‚Ä¢ Active nodes: ${step.activeIndices.join(', ')}<br>
                ‚Ä¢ Swap nodes: ${step.swapIndices.join(', ')}
            </div>
        `;
    }
}

function updateLog(step) {
    const logContent = document.getElementById('logContent');
    
    if (currentStep === 0) {
        logContent.innerHTML = '';
    }
    
    const logEntry = document.createElement('div');
    logEntry.className = `log-entry ${step.stepType.toLowerCase()}`;
    
    // Tentukan apakah konten panjang
    const messageLength = step.message.length;
    const hasMultipleLines = step.message.includes('<br>');
    if (messageLength > 150 || hasMultipleLines) {
        logEntry.classList.add('long-content');
    }
    
    const stepNum = step.stepNumber.toString().padStart(2, '0');
    
    logEntry.innerHTML = `
        <div class="log-entry-header">
            <div style="display: flex; align-items: center; gap: 10px;">
                <strong style="color: #0c2461; font-size: 1rem;">Step ${stepNum}: ${step.stepType}</strong>
                <span style="background: #f0f0f0; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem;">
                    ${step.stepNumber}
                </span>
            </div>
            <span style="font-size: 0.85rem; color: #666; font-family: monospace;">
                ${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'})}
            </span>
        </div>
        <div class="log-entry-content">
            ${step.message}
        </div>
        <div style="margin-top: 10px; font-size: 0.8rem; color: #888; text-align: right;">
            <span class="badge" style="background: #e0e0e0; padding: 2px 8px; border-radius: 10px;">
                Active: [${step.activeIndices.join(', ')}]
            </span>
            ${step.swapIndices.length > 0 ? 
                `<span class="badge" style="background: #4cd137; color: white; padding: 2px 8px; border-radius: 10px; margin-left: 5px;">
                    Swap: [${step.swapIndices.join(', ')}]
                </span>` : ''
            }
        </div>
    `;
    
    logContent.appendChild(logEntry);
    
    // Auto scroll ke entry terbaru
    logEntry.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

function updateStatus(step) {
    const statusElement = document.getElementById('status');
    const phaseIndicator = document.getElementById('phaseIndicator');
    const logPhaseIndicator = document.getElementById('logPhaseIndicator');
    
    let statusClass = 'status';
    let phaseText = '';
    let statusText = step.message.split('<br>')[0];
    
    switch(step.stepType) {
        case 'Leaf':
            statusClass = 'status leaf';
            phaseText = 'Identifikasi Leaf Nodes';
            break;
        case 'Build':
        case 'Heapify':
            statusClass = 'status build';
            phaseText = 'Build Max-Heap';
            break;
        case 'Sort':
            statusClass = 'status sort';
            phaseText = 'Heap Sort';
            const heapSize = getCurrentHeapSize(step);
            if (heapSize > 0) {
                statusText += ` | Heap Size: ${heapSize}`;
            }
            break;
        case 'Swap':
            statusClass = 'status sort';
            phaseText = 'Heap Sort - Swapping';
            if (step.swapIndices.length === 2) {
                const [i, j] = step.swapIndices;
                statusText = `üîÑ SWAP: [${i}] ‚áÑ [${j}]`;
            }
            break;
        case 'Complete':
            phaseText = 'Selesai';
            if (step.message.includes("HEAP SORT SELESAI")) {
                statusClass = 'status sort';
                statusText = "üéâ Heap Sort Selesai!";
            }
            break;
        default:
            phaseText = 'Inisialisasi';
    }
    
    statusElement.className = statusClass;
    statusElement.innerHTML = statusText;
    
    if (phaseIndicator) phaseIndicator.textContent = phaseText;
    if (logPhaseIndicator) logPhaseIndicator.textContent = `Phase: ${phaseText}`;
}

function updateStepCounter() {
    const stepCounter = document.getElementById('stepCounter');
    if (stepCounter) {
        stepCounter.textContent = `Step: ${currentStep + 1}/${steps.length}`;
    }
}

function updateButtons() {
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const autoBtn = document.getElementById('autoBtn');
    
    if (prevBtn) prevBtn.disabled = currentStep === 0;
    if (nextBtn) nextBtn.disabled = currentStep === steps.length - 1;
    
    if (currentStep === steps.length - 1 && autoBtn) {
        autoBtn.textContent = '‚ñ∂Ô∏è Jalankan Otomatis';
        if (autoPlayInterval) {
            clearInterval(autoPlayInterval);
            autoPlayInterval = null;
        }
    }
}

    // Default: jika step Complete dan ada "SELESAI", semua elemen terurut
    if (step.stepType === "Complete" && message.includes("SELESAI")) {
        return 0;
    }
    
    // Default untuk step Build/Heapify: semua elemen dalam heap
    if (step.stepType === "Build" || step.stepType === "Heapify" || step.stepType === "Leaf") {
        return step.hotels.length;
    }
    
    // Default untuk step Sort/Swap: berdasarkan konteks
    if (step.swapIndices.length === 2) {
        const [i, j] = step.swapIndices;
        // Jika swap antara root dan elemen lain
        if (i === 0 || j === 0) {
            const otherIndex = i === 0 ? j : i;
            if (otherIndex > 0) {
                return otherIndex + 1;
            }
        }
    }
    
    return step.hotels.length;
}


        function createTreeNode(hotel, index, step, positions, treeContainer) {
    if (!treeContainer) return;
    
    const position = positions[index];
    
    if (!position) {
        console.error(`No position defined for index ${index}`);
        return;
    }
    
    const node = document.createElement('div');
    node.className = 'tree-node';
    
    // Tentukan status node
    const isActive = step.activeIndices.includes(index);
    const isSwapping = step.swapIndices.includes(index);
    const leafIndices = identifyLeafNodes(step.hotels.length);
    const isLeaf = leafIndices.includes(index);
    const heapSize = getCurrentHeapSize(step);
    const isHeapSortPhase = isHeapSortStep(currentStep);
    const isRoot = index === 0;
    const isInHeap = index < heapSize;
    
    // Tambahkan kelas berdasarkan status
    if (isActive) node.classList.add('active');
    if (isSwapping) node.classList.add('swap');
    if (isRoot && isInHeap) node.classList.add('root');
    if (isLeaf) node.classList.add('leaf');
    
    // Set posisi
    node.style.left = `${position.x}px`;
    node.style.top = `${position.y}px`;
    
    // Tentukan warna border
    let borderColor = '#0c2461';
    if (isActive) borderColor = '#e55039';
    if (isSwapping) borderColor = '#4cd137';
    if (isRoot && isInHeap) borderColor = '#8c7ae6';
    if (isLeaf) borderColor = '#9c27b0';
    
    node.style.borderColor = borderColor;
    node.style.boxShadow = `0 4px 12px ${borderColor}40`;
    
    const shortName = getShortHotelName(hotel.name);
    
    // Buat konten node
    node.innerHTML = `
        <div style="position: absolute; top: -25px; left: 50%; transform: translateX(-50%);
              background: ${borderColor}; color: white; padding: 3px 10px; 
              border-radius: 12px; font-size: 0.8rem; font-weight: bold; z-index: 20;
              white-space: nowrap; min-width: 80px; text-align: center;">
            [${index}] ${isRoot && isInHeap ? 'ROOT' : isLeaf ? 'LEAF' : 'NODE'}
        </div>
        
        <div style="text-align: center; padding: 10px;">
            <div style="font-weight: bold; color: #0c2461; font-size: 1rem; 
                  margin-bottom: 8px; height: 2.2em; display: flex; 
                  align-items: center; justify-content: center;">
                ${shortName}
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px; 
                  font-size: 0.8rem; margin-bottom: 8px;">
                <div style="text-align: left; color: #555;">
                    <div>‚≠ê ${hotel.rating}</div>
                    <div>üëç ${hotel.popularity}</div>
                </div>
                <div style="text-align: right; color: #555;">
                    <div>üí∞ $${hotel.price}</div>
                    <div>üìç ${hotel.distance}km</div>
                </div>
            </div>
            
            <div style="padding: 5px; background: #f8f9fa; border-radius: 6px; 
                  font-size: 0.75rem; border: 1px solid #eee;">
                <strong style="color: ${borderColor};">Priority:</strong> 
                <span style="font-weight: bold; color: #e55039; margin-left: 5px;">
                    ${hotel.priority.toFixed(1)}
                </span>
            </div>
        </div>
        
        ${isHeapSortPhase ? 
            `<div style="position: absolute; bottom: -22px; left: 0; right: 0;
                  text-align: center; color: ${isInHeap ? '#2196f3' : '#4caf50'}; 
                  font-size: 0.65rem; font-weight: bold; background: white; padding: 2px 4px;
                  border-radius: 6px; border: 1px solid ${isInHeap ? '#2196f3' : '#4caf50'};">
                ${isInHeap ? 'üîµ DALAM HEAP' : '‚úÖ TERURUT'}
            </div>` : ''}
        
        ${isActive ? 
            `<div style="position: absolute; bottom: ${isHeapSortPhase ? '-45px' : '-25px'}; left: 0; right: 0;
                  text-align: center; color: #e55039; font-size: 0.75rem; 
                  font-weight: bold; animation: nodeHighlight 1s infinite;
                  background: white; padding: 3px; border-radius: 10px;
                  box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                üîç SEDANG DIPROSES
            </div>` : ''}
    `;
    
    // Tambahkan animasi jika diperlukan
    if (isActive) {
        node.style.animation = 'nodeHighlight 1s infinite';
    }
    
    if (isSwapping) {
        node.style.animation = 'swapPulse 0.5s';
    }
    
    treeContainer.appendChild(node);
}
function createTreeNode(hotel, index, step, positions) {
    const treeContainer = document.getElementById('treeContainer');
    const position = positions[index];
    
    if (!position) return;
    
    const node = document.createElement('div');
    node.className = 'tree-node';
    
    // Tentukan status node
    const isActive = step.activeIndices.includes(index);
    const isSwapping = step.swapIndices.includes(index);
    const leafIndices = identifyLeafNodes(step.hotels.length);
    const isLeaf = leafIndices.includes(index);
    const heapSize = getCurrentHeapSize(step);
    const isHeapSortPhase = isHeapSortStep(currentStep);
    const isRoot = index === 0;
    const isInHeap = index < heapSize;
    
    // Tambahkan kelas berdasarkan status
    if (isActive) node.classList.add('active');
    if (isSwapping) node.classList.add('swap');
    if (isRoot && isInHeap) node.classList.add('root');
    if (isLeaf) node.classList.add('leaf');
    
    // Set posisi
    node.style.left = `${position.x}px`;
    node.style.top = `${position.y}px`;
    
    // Tentukan warna border
    let borderColor = '#0c2461';
    if (isActive) borderColor = '#e55039';
    if (isSwapping) borderColor = '#4cd137';
    if (isRoot && isInHeap) borderColor = '#8c7ae6';
    if (isLeaf) borderColor = '#9c27b0';
    
    node.style.borderColor = borderColor;
    node.style.boxShadow = `0 4px 12px ${borderColor}40`;
    
    const shortName = getShortHotelName(hotel.name);
    
    // Buat konten node
    node.innerHTML = `
        <div style="position: absolute; top: -25px; left: 50%; transform: translateX(-50%);
              background: ${borderColor}; color: white; padding: 3px 10px; 
              border-radius: 12px; font-size: 0.8rem; font-weight: bold; z-index: 20;
              white-space: nowrap; min-width: 80px; text-align: center;">
            [${index}] ${isRoot && isInHeap ? 'ROOT' : isLeaf ? 'LEAF' : 'NODE'}
        </div>
        
        <div style="text-align: center; padding: 10px;">
            <div style="font-weight: bold; color: #0c2461; font-size: 1rem; 
                  margin-bottom: 8px; height: 2.2em; display: flex; 
                  align-items: center; justify-content: center;">
                ${shortName}
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px; 
                  font-size: 0.8rem; margin-bottom: 8px;">
                <div style="text-align: left; color: #555;">
                    <div>‚≠ê ${hotel.rating}</div>
                    <div>üëç ${hotel.popularity}</div>
                </div>
                <div style="text-align: right; color: #555;">
                    <div>üí∞ $${hotel.price}</div>
                    <div>üìç ${hotel.distance}km</div>
                </div>
            </div>
            
            <div style="padding: 5px; background: #f8f9fa; border-radius: 6px; 
                  font-size: 0.75rem; border: 1px solid #eee;">
                <strong style="color: ${borderColor};">Priority:</strong> 
                <span style="font-weight: bold; color: #e55039; margin-left: 5px;">
                    ${hotel.priority.toFixed(1)}
                </span>
            </div>
        </div>
        
        ${isHeapSortPhase ? 
            `<div style="position: absolute; bottom: -22px; left: 0; right: 0;
                  text-align: center; color: ${isInHeap ? '#2196f3' : '#4caf50'}; 
                  font-size: 0.65rem; font-weight: bold; background: white; padding: 2px 4px;
                  border-radius: 6px; border: 1px solid ${isInHeap ? '#2196f3' : '#4caf50'};">
                ${isInHeap ? 'üîµ DALAM HEAP' : '‚úÖ TERURUT'}
            </div>` : ''}
    `;
    
    // Tambahkan animasi jika diperlukan
    if (isActive) {
        node.style.animation = 'nodeHighlight 1s infinite';
    }
    
    if (isSwapping) {
        node.style.animation = 'swapPulse 0.5s';
    }
    
    treeContainer.appendChild(node);
}
        function updatePriorityList(step) {
    const priorityList = document.getElementById('priorityList');
    if (!priorityList) return;
    
    priorityList.innerHTML = '';
    
    // JANGAN diurutkan berdasarkan priority, tapi ambil dari step.hotels langsung
    // Karena step.hotels sudah dalam urutan heap yang benar (index 0-5)
    step.hotels.forEach((hotel, index) => {
        const originalIndex = index; // Index dalam heap
        const item = document.createElement('li');
        item.className = 'priority-item';
        
        if (step.activeIndices.includes(originalIndex)) item.classList.add('active');
        
        // Tentukan apakah leaf node
        const leafIndices = identifyLeafNodes(step.hotels.length);
        if (leafIndices.includes(originalIndex)) item.classList.add('leaf-node');
        
        // Tampilkan ranking berdasarkan urutan dalam heap (index + 1)
        const rank = index + 1;
        
        item.innerHTML = `
            <span class="priority-rank">${rank}</span>
            <div style="flex: 1;">
                <strong>${getShortHotelName(hotel.name)}</strong>
                <div style="font-size: 0.85rem; color: #666; margin-top: 3px;">
                    Priority: <strong>${hotel.priority.toFixed(1)}</strong> | 
                    Index: [${originalIndex}] | 
                    ${leafIndices.includes(originalIndex) ? 'üçÉ Leaf' : 'üåø Non-leaf'}
                </div>
            </div>
        `;
        
        priorityList.appendChild(item);
    });
}

        function updateCalculations(step) {
            const calculationsContent = document.getElementById('calculationsContent');
            const n = step.hotels.length;
            const heapSize = getCurrentHeapSize(step);
            const isHeapSortPhase = isHeapSortStep(currentStep);
            
            if (step.stepType === "Leaf") {
                const leafIndices = identifyLeafNodes(n);
                calculationsContent.innerHTML = `
                    <div class="calculation-box">
                        <strong>üçÉ ANALISIS LEAF NODES:</strong><br>
                        ‚Ä¢ n = ${n} hotel<br>
                        ‚Ä¢ Leaf mulai dari: floor(${n}/2) = ${Math.floor(n/2)}<br>
                        ‚Ä¢ Leaf indices: ${leafIndices.join(', ')}<br>
                        ‚Ä¢ Leaf hotels: ${leafIndices.map(i => getShortHotelName(step.hotels[i].name)).join(', ')}<br><br>
                        <em>Leaf nodes tidak perlu di-heapify karena tidak memiliki child nodes.</em>
                    </div>
                `;
            } else if (isHeapSortPhase) {
                let content = `<div class="calculation-box"><strong>üìä ANALISIS HEAP SORT:</strong><br><br>`;
                
                if (step.swapIndices.length === 2) {
                    const [idx1, idx2] = step.swapIndices;
                    content += `<strong>üîÑ PROSES SWAP:</strong><br>`;
                    content += `‚Ä¢ Index ${idx1}: ${getShortHotelName(step.hotels[idx1].name)} (${step.hotels[idx1].priority.toFixed(1)})<br>`;
                    content += `‚Ä¢ Index ${idx2}: ${getShortHotelName(step.hotels[idx2].name)} (${step.hotels[idx2].priority.toFixed(1)})<br>`;
                    
                    if (idx1 === 0 || idx2 === 0) {
                        content += `<br><strong>üí° ALGORITMA HEAP SORT:</strong><br>`;
                        content += `1. Swap root (index 0) dengan elemen terakhir heap<br>`;
                        content += `2. Kurangi heap size menjadi ${heapSize}<br>`;
                        content += `3. Heapify root baru untuk menjaga max-heap property<br>`;
                    }
                }
                
                content += `<br><strong>üìà STATUS HEAP:</strong><br>`;
                content += `‚Ä¢ Total elemen: ${n}<br>`;
                content += `‚Ä¢ Heap size aktif: ${heapSize} elemen<br>`;
                content += `‚Ä¢ Elemen terurut: ${n - heapSize} elemen<br>`;
                
                if (heapSize > 0) {
                    content += `<br><strong>üîµ ELEMEN DALAM HEAP:</strong><br>`;
                    for (let i = 0; i < heapSize; i++) {
                        const isRoot = i === 0;
                        content += `${isRoot ? 'üëë ' : ''}[${i}] ${getShortHotelName(step.hotels[i].name)} (${step.hotels[i].priority.toFixed(1)})<br>`;
                    }
                }
                
                if (n - heapSize > 0) {
                    content += `<br><strong>‚úÖ ELEMEN TERURUT:</strong><br>`;
                    for (let i = heapSize; i < n; i++) {
                        content += `[${i}] ${getShortHotelName(step.hotels[i].name)} (${step.hotels[i].priority.toFixed(1)})<br>`;
                    }
                }
                
                content += `</div>`;
                calculationsContent.innerHTML = content;
            } else if (step.stepType === "Build") {
                calculationsContent.innerHTML = `
                    <div class="calculation-box">
                        <strong>üî® BUILD MAX-HEAP PROCESS:</strong><br><br>
                        ‚Ä¢ n = ${n} elements<br>
                        ‚Ä¢ Leaf nodes: ${identifyLeafNodes(n).join(', ')}<br>
                        ‚Ä¢ Non-leaf nodes: ${Array.from({length: Math.floor(n/2)}, (_, i) => i).join(', ')}<br>
                        ‚Ä¢ Build order: ${Array.from({length: Math.floor(n/2)}, (_, i) => Math.floor(n/2)-1-i).join(' ‚Üí ')}<br><br>
                        <em>Setiap node di-heapify untuk memastikan parent memiliki nilai lebih BESAR dari children.</em>
                    </div>
                `;
            }
        }

        function updateLog(step) {
            const logContent = document.getElementById('logContent');
            
            if (currentStep === 0) {
                logContent.innerHTML = '';
            }
            
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${step.stepType.toLowerCase()}`;
            
            const stepNum = step.stepNumber.toString().padStart(2, '0');
            logEntry.innerHTML = `
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <strong>Step ${stepNum}: ${step.stepType}</strong>
                    <span style="font-size: 0.8rem; color: #666;">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'})}</span>
                </div>
                <div>${step.message}</div>
            `;
            
            logContent.appendChild(logEntry);
            logContent.scrollTop = logContent.scrollHeight;
        }

        function updateStatus(step) {
            const statusElement = document.getElementById('status');
            const phaseIndicator = document.getElementById('phaseIndicator');
            const logPhaseIndicator = document.getElementById('logPhaseIndicator');
            
            let statusClass = 'status';
            let phaseText = '';
            let statusText = step.message.split('<br>')[0];
            
            switch(step.stepType) {
                case 'Leaf':
                    statusClass = 'status leaf';
                    phaseText = 'Identifikasi Leaf Nodes';
                    break;
                case 'Build':
                case 'Heapify':
                    statusClass = 'status build';
                    phaseText = 'Build Max-Heap';
                    break;
                case 'Sort':
                    statusClass = 'status sort';
                    phaseText = 'Heap Sort';
                    const heapSize = getCurrentHeapSize(step);
                    if (heapSize > 0) {
                        statusText += ` | Heap Size: ${heapSize}`;
                    }
                    break;
                case 'Swap':
                    statusClass = 'status sort';
                    phaseText = 'Heap Sort - Swapping';
                    if (step.swapIndices.length === 2) {
                        const [i, j] = step.swapIndices;
                        statusText = `üîÑ SWAP: [${i}] ‚áÑ [${j}]`;
                    }
                    break;
                case 'Complete':
                    phaseText = 'Selesai';
                    if (step.message.includes("HEAP SORT SELESAI")) {
                        statusClass = 'status sort';
                        statusText = "üéâ Heap Sort Selesai!";
                    }
                    break;
                default:
                    phaseText = 'Inisialisasi';
            }
            
            statusElement.className = statusClass;
            statusElement.innerHTML = statusText;
            
            if (phaseIndicator) phaseIndicator.textContent = phaseText;
            if (logPhaseIndicator) logPhaseIndicator.textContent = `Phase: ${phaseText}`;
        }

        function updateStepCounter() {
            const stepCounter = document.getElementById('stepCounter');
            stepCounter.textContent = `Step: ${currentStep + 1}/${steps.length}`;
        }

        function updateButtons() {
            document.getElementById('prevBtn').disabled = currentStep === 0;
            document.getElementById('nextBtn').disabled = currentStep === steps.length - 1;
            
            if (currentStep === steps.length - 1) {
                document.getElementById('autoBtn').textContent = '‚ñ∂Ô∏è Jalankan Otomatis';
                if (autoPlayInterval) {
                    clearInterval(autoPlayInterval);
                    autoPlayInterval = null;
                }
            }
        }

        // ==================== EVENT HANDLERS ====================
        document.getElementById('prevBtn').addEventListener('click', () => {
            if (currentStep > 0) {
                currentStep--;
                updateDisplay();
            }
        });

        document.getElementById('nextBtn').addEventListener('click', () => {
            if (currentStep < steps.length - 1) {
                currentStep++;
                updateDisplay();
            }
        });

        document.getElementById('autoBtn').addEventListener('click', () => {
            if (autoPlayInterval) {
                clearInterval(autoPlayInterval);
                autoPlayInterval = null;
                document.getElementById('autoBtn').textContent = '‚ñ∂Ô∏è Jalankan Otomatis';
            } else {
                document.getElementById('autoBtn').textContent = '‚è∏Ô∏è Berhenti';
                autoPlayInterval = setInterval(() => {
                    if (currentStep < steps.length - 1) {
                        currentStep++;
                        updateDisplay();
                    } else {
                        clearInterval(autoPlayInterval);
                        autoPlayInterval = null;
                        document.getElementById('autoBtn').textContent = '‚ñ∂Ô∏è Jalankan Otomatis';
                    }
                }, autoPlaySpeed);
            }
        });

        document.getElementById('speedUpBtn').addEventListener('click', () => {
            autoPlaySpeed = Math.max(500, autoPlaySpeed - 500);
            if (autoPlayInterval) {
                clearInterval(autoPlayInterval);
                autoPlayInterval = setInterval(() => {
                    if (currentStep < steps.length - 1) {
                        currentStep++;
                        updateDisplay();
                    } else {
                        clearInterval(autoPlayInterval);
                        autoPlayInterval = null;
                    }
                }, autoPlaySpeed);
            }
        });

        document.getElementById('speedDownBtn').addEventListener('click', () => {
            autoPlaySpeed = Math.min(5000, autoPlaySpeed + 500);
            if (autoPlayInterval) {
                clearInterval(autoPlayInterval);
                autoPlayInterval = setInterval(() => {
                    if (currentStep < steps.length - 1) {
                        currentStep++;
                        updateDisplay();
                    } else {
                        clearInterval(autoPlayInterval);
                        autoPlayInterval = null;
                    }
                }, autoPlaySpeed);
            }
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            if (autoPlayInterval) {
                clearInterval(autoPlayInterval);
                autoPlayInterval = null;
                document.getElementById('autoBtn').textContent = '‚ñ∂Ô∏è Jalankan Otomatis';
            }
            initSimulation();
        });

        // ==================== INITIALIZE ====================
        initSimulation();
		
	// Tambahkan di bagian event handlers
document.getElementById('clearLogBtn').addEventListener('click', () => {
    document.getElementById('logContent').innerHTML = '';
});

document.getElementById('expandLogBtn').addEventListener('click', () => {
    const logDiv = document.querySelector('.log');
    logDiv.style.maxHeight = '800px';
    logDiv.style.height = '800px';
});

document.getElementById('collapseLogBtn').addEventListener('click', () => {
    const logDiv = document.querySelector('.log');
    logDiv.style.maxHeight = '400px';
    logDiv.style.height = 'auto';
});

document.getElementById('exportLogBtn').addEventListener('click', () => {
    const logContent = document.getElementById('logContent');
    const logText = Array.from(logContent.children)
        .map(entry => {
            const stepNum = entry.querySelector('strong').textContent;
            const time = entry.querySelector('span[style*="monospace"]').textContent;
            const content = entry.querySelector('.log-entry-content').textContent;
            return `${stepNum} | ${time}\n${content}\n${'='.repeat(80)}\n`;
        })
        .join('\n');
    
    const blob = new Blob([logText], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `heap-sort-log-${new Date().toISOString().slice(0,10)}.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
});	
		
		
    </script>
</body>
</html>